

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.jpg">
  <link rel="icon" href="/blog/img/favicon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Azure">
  <meta name="keywords" content="">
  
    <meta name="description" content="umiæ¡†æ¶">
<meta property="og:type" content="article">
<meta property="og:title" content="umiåŸºç¡€">
<meta property="og:url" content="https://yoonalis.github.io/blog/2022/11/28/umi/index.html">
<meta property="og:site_name" content="Azure&#39;s blog">
<meta property="og:description" content="umiæ¡†æ¶">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yoonalis.github.io/blog/img/umi.png">
<meta property="article:published_time" content="2022-11-28T13:26:20.042Z">
<meta property="article:modified_time" content="2022-11-28T13:57:05.246Z">
<meta property="article:author" content="Azure">
<meta property="article:tag" content="å‰ç«¯">
<meta property="article:tag" content="umiæ¡†æ¶">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yoonalis.github.io/blog/img/umi.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>umiåŸºç¡€ - Azure&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yoonalis.github.io","root":"/blog/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/blog/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>Azure</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/album/">
                <i class="iconfont icon-images"></i>
                album
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="umiåŸºç¡€"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-28 21:26" pubdate>
          2022å¹´11æœˆ28æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          20k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          171 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">umiåŸºç¡€</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Umi"><a href="#Umi" class="headerlink" title="Umi"></a>Umi</h1><p>Umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸º<strong>ä¹Œç±³</strong>ï¼Œæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>Umi æ˜¯èš‚èšé›†å›¢çš„åº•å±‚å‰ç«¯æ¡†æ¶ï¼Œå·²ç›´æ¥æˆ–é—´æ¥åœ°æœåŠ¡äº† 3000+ åº”ç”¨ï¼ŒåŒ…æ‹¬ javaã€nodeã€H5 æ— çº¿ã€ç¦»çº¿ï¼ˆHybridï¼‰åº”ç”¨ã€çº¯å‰ç«¯ assets åº”ç”¨ã€CMS åº”ç”¨ç­‰ã€‚ä»–å·²ç»å¾ˆå¥½åœ°æœåŠ¡äº†æˆ‘ä»¬çš„å†…éƒ¨ç”¨æˆ·ï¼ŒåŒæ—¶å¸Œæœ›ä»–ä¹Ÿèƒ½æœåŠ¡å¥½å¤–éƒ¨ç”¨æˆ·ã€‚</p>
<p>å®ƒä¸»è¦å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>ğŸ‰ <strong>å¯æ‰©å±•</strong>ï¼ŒUmi å®ç°äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä½¿å…¶æ’ä»¶åŒ–ï¼ŒUmi å†…éƒ¨åŠŸèƒ½ä¹Ÿå…¨ç”±æ’ä»¶å®Œæˆã€‚æ­¤å¤–è¿˜æ”¯æŒæ’ä»¶å’Œæ’ä»¶é›†ï¼Œä»¥æ»¡è¶³åŠŸèƒ½å’Œå‚ç›´åŸŸçš„åˆ†å±‚éœ€æ±‚ã€‚</li>
<li>ğŸ“¦ <strong>å¼€ç®±å³ç”¨</strong>ï¼ŒUmi å†…ç½®äº†è·¯ç”±ã€æ„å»ºã€éƒ¨ç½²ã€æµ‹è¯•ç­‰ï¼Œä»…éœ€ä¸€ä¸ªä¾èµ–å³å¯ä¸Šæ‰‹å¼€å‘ã€‚å¹¶ä¸”è¿˜æä¾›é’ˆå¯¹ React çš„é›†æˆæ’ä»¶é›†ï¼Œå†…æ¶µä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¯æ»¡è¶³æ—¥å¸¸ 80% çš„å¼€å‘éœ€æ±‚ã€‚</li>
<li>ğŸ  <strong>ä¼ä¸šçº§</strong>ï¼Œç»èš‚èšå†…éƒ¨ 3000+ é¡¹ç›®ä»¥åŠé˜¿é‡Œã€ä¼˜é…·ã€ç½‘æ˜“ã€é£çŒªã€å£ç¢‘ç­‰å…¬å¸é¡¹ç›®çš„éªŒè¯ï¼Œå€¼å¾—ä¿¡èµ–ã€‚</li>
<li>ğŸš€ <strong>å¤§é‡è‡ªç ”</strong>ï¼ŒåŒ…å«å¾®å‰ç«¯ã€ç»„ä»¶æ‰“åŒ…ã€æ–‡æ¡£å·¥å…·ã€è¯·æ±‚åº“ã€hooks åº“ã€æ•°æ®æµç­‰ï¼Œæ»¡è¶³æ—¥å¸¸é¡¹ç›®çš„å‘¨è¾¹éœ€æ±‚ã€‚</li>
<li>ğŸŒ´ <strong>å®Œå¤‡è·¯ç”±</strong>ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼ŒåŒæ—¶ä¿æŒåŠŸèƒ½çš„å®Œå¤‡æ€§ï¼Œæ¯”å¦‚åŠ¨æ€è·¯ç”±ã€åµŒå¥—è·¯ç”±ã€æƒé™è·¯ç”±ç­‰ç­‰ã€‚</li>
<li>ğŸš„ <strong>é¢å‘æœªæ¥</strong>ï¼Œåœ¨æ»¡è¶³éœ€æ±‚çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šåœæ­¢å¯¹æ–°æŠ€æœ¯çš„æ¢ç´¢ã€‚æ¯”å¦‚ dll æé€Ÿã€modern modeã€webpack@5ã€è‡ªåŠ¨åŒ– externalã€bundler less ç­‰ç­‰ã€‚</li>
</ul>
<h2 id="umi-ä¸´æ—¶æ–‡ä»¶"><a href="#umi-ä¸´æ—¶æ–‡ä»¶" class="headerlink" title=".umi ä¸´æ—¶æ–‡ä»¶"></a>.umi ä¸´æ—¶æ–‡ä»¶</h2><p>.umi ä¸´æ—¶ç›®å½•æ˜¯æ•´ä¸ª Umi é¡¹ç›®çš„å‘åŠ¨æœºï¼Œä½ çš„å…¥å£æ–‡ä»¶ã€è·¯ç”±ç­‰ç­‰éƒ½åœ¨è¿™é‡Œï¼Œè¿™äº›æ˜¯ç”± umi å†…éƒ¨æ’ä»¶åŠä¸‰æ–¹æ’ä»¶ç”Ÿæˆçš„ã€‚</p>
<p>ä½ é€šå¸¸ä¼šåœ¨ .umi ä¸‹çœ‹åˆ°ä»¥ä¸‹ç›®å½•ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">+ .umi<br>  + core     <span class="hljs-comment"># å†…éƒ¨æ’ä»¶ç”Ÿæˆ</span><br>  + pluginA  <span class="hljs-comment"># å¤–éƒ¨æ’ä»¶ç”Ÿæˆ</span><br>  + presetB  <span class="hljs-comment"># å¤–éƒ¨æ’ä»¶ç”Ÿæˆ</span><br>  + umi.ts   <span class="hljs-comment"># å…¥å£æ–‡ä»¶</span><br></code></pre></td></tr></table></figure>

<p>ä¸´æ—¶æ–‡ä»¶æ˜¯ Umi æ¡†æ¶ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œæ¡†æ¶æˆ–æ’ä»¶ä¼šæ ¹æ®ä½ çš„ä»£ç ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼Œè¿™äº›åŸæ¥éœ€è¦æ”¾åœ¨é¡¹ç›®é‡Œçš„è„ä¹±å·®çš„éƒ¨åˆ†éƒ½è¢«è—åœ¨äº†è¿™é‡Œã€‚</p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡Œè°ƒè¯•ä»£ç ï¼Œä½†ä¸è¦åœ¨ .git ä»“åº“é‡Œæäº¤ä»–ï¼Œå› ä¸ºä»–çš„ä¸´æ—¶æ€§ï¼Œæ¯æ¬¡å¯åŠ¨ umi æ—¶éƒ½ä¼šè¢«åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆã€‚</p>
<h2 id="éƒ¨ç½²å‘å¸ƒ"><a href="#éƒ¨ç½²å‘å¸ƒ" class="headerlink" title="éƒ¨ç½²å‘å¸ƒ"></a>éƒ¨ç½²å‘å¸ƒ</h2><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yarn build<br>âœ” Webpack  Compiled successfully <span class="hljs-keyword">in</span> 17.17s<br> DONE  Compiled successfully <span class="hljs-keyword">in</span> 17167ms                                       8:26:25 PM<br>Build success.âœ¨  Done <span class="hljs-keyword">in</span> 20.79s.<br></code></pre></td></tr></table></figure>

<p>æ„å»ºäº§ç‰©é»˜è®¤ç”Ÿæˆåˆ° <code>./dist</code> ä¸‹ï¼Œç„¶åé€šè¿‡ tree å‘½ä»¤æŸ¥çœ‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tree ./dist<br>./distâ”œâ”€â”€ index.htmlâ”œâ”€â”€ umi.cssâ””â”€â”€ umi.js<br></code></pre></td></tr></table></figure>

<h3 id="æœ¬åœ°éªŒè¯"><a href="#æœ¬åœ°éªŒè¯" class="headerlink" title="æœ¬åœ°éªŒè¯"></a>æœ¬åœ°éªŒè¯</h3><p>å‘å¸ƒä¹‹å‰ï¼Œå¯ä»¥é€šè¿‡ <code>serve</code> åšæœ¬åœ°éªŒè¯ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ yarn global add serve$ serve ./dist<br>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                                    â”‚   â”‚   Serving!                                         â”‚   â”‚                                                    â”‚   â”‚   - Local:            http://localhost:5000        â”‚   â”‚   - On Your Network:  http://192.168.12.34:5000    â”‚   â”‚                                                    â”‚   â”‚   Copied <span class="hljs-built_in">local</span> address to clipboard!               â”‚   â”‚                                                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure>

<p>è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000</a>ï¼Œæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯å’Œæ‰§è¡Œ <code>yarn start</code> æ—¶æ˜¯ä¸€è‡´çš„ã€‚</p>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p>æœ¬åœ°éªŒè¯å®Œï¼Œå°±å¯ä»¥éƒ¨ç½²äº†ã€‚ä½ éœ€è¦æŠŠ <code>dist</code> ç›®å½•éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚</p>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>ä¸€ä¸ªåŸºç¡€çš„ Umi é¡¹ç›®å¤§è‡´æ˜¯è¿™æ ·çš„ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs unknown">.<br>â”œâ”€â”€ package.json<br>â”œâ”€â”€ .umirc.ts<br>â”œâ”€â”€ .env<br>â”œâ”€â”€ dist<br>â”œâ”€â”€ mock<br>â”œâ”€â”€ public<br>â””â”€â”€ src<br>    â”œâ”€â”€ .umi<br>    â”œâ”€â”€ layouts/index.tsx<br>    â”œâ”€â”€ pages<br>        â”œâ”€â”€ index.less<br>        â””â”€â”€ index.tsx<br>    â””â”€â”€ app.ts<br></code></pre></td></tr></table></figure>

<h3 id="æ ¹ç›®å½•"><a href="#æ ¹ç›®å½•" class="headerlink" title="æ ¹ç›®å½•"></a>æ ¹ç›®å½•</h3><h4 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h4><p>åŒ…å«æ’ä»¶å’Œæ’ä»¶é›†ï¼Œä»¥ <code>@umijs/preset-</code>ã€<code>@umijs/plugin-</code>ã€<code>umi-preset-</code> å’Œ <code>umi-plugin-</code> å¼€å¤´çš„ä¾èµ–ä¼šè¢«è‡ªåŠ¨æ³¨å†Œä¸ºæ’ä»¶æˆ–æ’ä»¶é›†ã€‚</p>
<h4 id="umirc-ts"><a href="#umirc-ts" class="headerlink" title=".umirc.ts"></a>.umirc.ts</h4><p>é…ç½®æ–‡ä»¶ï¼ŒåŒ…å« umi å†…ç½®åŠŸèƒ½å’Œæ’ä»¶çš„é…ç½®ã€‚</p>
<h4 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h4><p>ç¯å¢ƒå˜é‡ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs unknown">PORT=8888<br>COMPRESS=none<br></code></pre></td></tr></table></figure>

<h4 id="dist-ç›®å½•"><a href="#dist-ç›®å½•" class="headerlink" title="dist ç›®å½•"></a>dist ç›®å½•</h4><p>æ‰§è¡Œ <code>umi build</code> åï¼Œäº§ç‰©é»˜è®¤ä¼šå­˜æ”¾åœ¨è¿™é‡Œã€‚</p>
<h4 id="mock-ç›®å½•"><a href="#mock-ç›®å½•" class="headerlink" title="mock ç›®å½•"></a>mock ç›®å½•</h4><p>å­˜å‚¨ mock æ–‡ä»¶ï¼Œæ­¤ç›®å½•ä¸‹æ‰€æœ‰ js å’Œ ts æ–‡ä»¶ä¼šè¢«è§£æä¸º mock æ–‡ä»¶ã€‚</p>
<h4 id="public-ç›®å½•"><a href="#public-ç›®å½•" class="headerlink" title="public ç›®å½•"></a>public ç›®å½•</h4><p>æ­¤ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¼šè¢« copy åˆ°è¾“å‡ºè·¯å¾„ã€‚</p>
<h3 id="src-ç›®å½•"><a href="#src-ç›®å½•" class="headerlink" title="/src ç›®å½•"></a><code>/src</code> ç›®å½•</h3><h4 id="umi-ç›®å½•"><a href="#umi-ç›®å½•" class="headerlink" title=".umi ç›®å½•"></a>.umi ç›®å½•</h4><p>ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚å…¥å£æ–‡ä»¶ã€è·¯ç”±ç­‰ï¼Œéƒ½ä¼šè¢«ä¸´æ—¶ç”Ÿæˆåˆ°è¿™é‡Œã€‚<strong>ä¸è¦æäº¤ .umi ç›®å½•åˆ° git ä»“åº“ï¼Œä»–ä»¬ä¼šåœ¨ umi dev å’Œ umi build æ—¶è¢«åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆã€‚</strong></p>
<h4 id="layouts-x2F-index-tsx"><a href="#layouts-x2F-index-tsx" class="headerlink" title="layouts&#x2F;index.tsx"></a>layouts&#x2F;index.tsx</h4><p>çº¦å®šå¼è·¯ç”±æ—¶çš„å…¨å±€å¸ƒå±€æ–‡ä»¶ã€‚</p>
<h4 id="pages-ç›®å½•"><a href="#pages-ç›®å½•" class="headerlink" title="pages ç›®å½•"></a>pages ç›®å½•</h4><p>æ‰€æœ‰è·¯ç”±ç»„ä»¶å­˜æ”¾åœ¨è¿™é‡Œã€‚</p>
<h4 id="app-ts"><a href="#app-ts" class="headerlink" title="app.ts"></a>app.ts</h4><p>è¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰©å±•è¿è¡Œæ—¶çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ä¿®æ”¹è·¯ç”±ã€ä¿®æ”¹ render æ–¹æ³•ç­‰ã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>Umi åœ¨ <code>.umirc.ts</code> æˆ– <code>config/config.ts</code> ä¸­é…ç½®é¡¹ç›®å’Œæ’ä»¶ï¼Œæ”¯æŒ es6ã€‚ä¸€ä»½å¸¸è§çš„é…ç½®å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> default &#123;<br>  base: <span class="hljs-string">&#x27;/docs/&#x27;</span>,<br>  publicPath: <span class="hljs-string">&#x27;/static/&#x27;</span>,<br>  <span class="hljs-built_in">hash</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-built_in">history</span>: &#123;<br>    <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;hash&#x27;</span>,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>å¦‚æœé¡¹ç›®çš„é…ç½®ä¸å¤æ‚ï¼Œæ¨èåœ¨ <code>.umirc.ts</code> ä¸­å†™é…ç½®ï¼› å¦‚æœé¡¹ç›®çš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥å°†é…ç½®å†™åœ¨ <code>config/config.ts</code> ä¸­ï¼Œå¹¶æŠŠé…ç½®çš„ä¸€éƒ¨åˆ†æ‹†åˆ†å‡ºå»ï¼Œæ¯”å¦‚è·¯ç”±é…ç½®å¯ä»¥æ‹†åˆ†æˆå•ç‹¬çš„ <code>routes.ts</code>ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// config/routes.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [    &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;index&#x27;</span> &#125;,];<br><span class="hljs-comment">// config/config.ts</span><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span>;<br><span class="hljs-keyword">import</span> routes <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./routes&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;  <br>    <span class="hljs-attr">routes</span>: routes,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>æ¨èä¸¤ç§é…ç½®æ–¹å¼äºŒé€‰ä¸€ï¼Œ<code>.umirc.ts</code> ä¼˜å…ˆçº§æ›´é«˜ã€‚</p>
<h3 id="TypeScript-æç¤º"><a href="#TypeScript-æç¤º" class="headerlink" title="TypeScript æç¤º"></a>TypeScript æç¤º</h3><p>å¦‚æœä½ æƒ³åœ¨å†™é…ç½®æ—¶ä¹Ÿæœ‰æç¤ºï¼Œå¯ä»¥é€šè¿‡ umi çš„ <code>defineConfig</code> æ–¹æ³•å®šä¹‰é…ç½®ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;  <br>    <span class="hljs-attr">routes</span>: [    <br>        &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,  <br>    ],<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><img src="https://img.alicdn.com/tfs/TB1EV1pv.T1gK0jSZFhXXaAtVXa-1204-838.png" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<h3 id="æœ¬åœ°ä¸´æ—¶é…ç½®"><a href="#æœ¬åœ°ä¸´æ—¶é…ç½®" class="headerlink" title="æœ¬åœ°ä¸´æ—¶é…ç½®"></a>æœ¬åœ°ä¸´æ—¶é…ç½®</h3><p>å¯ä»¥æ–°å»º <code>.umirc.local.ts</code>ï¼Œè¿™ä»½é…ç½®ä¼šå’Œ <code>.umirc.ts</code> åš deep merge åå½¢æˆæœ€ç»ˆé…ç½®ã€‚</p>
<blockquote>
<p>æ³¨ï¼š<code>.umirc.local.ts</code> ä»…åœ¨ <code>umi dev</code> æ—¶æœ‰æ•ˆã€‚<code>umi build</code> æ—¶ä¸ä¼šè¢«åŠ è½½ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// .umirc.ts æˆ–è€… config/config.tsexport default &#123; a: 1, b: 2 &#125;;</span><br><span class="hljs-comment">// .umirc.local.ts æˆ–è€… config/config.local.tsexport default &#123; c: &#x27;local&#x27; &#125;;</span><br></code></pre></td></tr></table></figure>

<p>æ‹¿åˆ°çš„é…ç½®æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-attr">c</span>: <span class="hljs-string">&#x27;local&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li><code>config/config.ts</code> å¯¹åº”çš„æ˜¯ <code>config/config.local.ts</code></li>
<li><code>.local.ts</code> æ˜¯æœ¬åœ°éªŒè¯ä½¿ç”¨çš„ä¸´æ—¶é…ç½®ï¼Œè¯·å°†å…¶æ·»åŠ åˆ° <code>.gitignore</code>ï¼Œ<strong>åŠ¡å¿…ä¸è¦æäº¤åˆ° git ä»“åº“ä¸­</strong></li>
<li><code>.local.ts</code> é…ç½®çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ¯” <code>UMI_ENV</code> æŒ‡å®šçš„é…ç½®æ›´é«˜</li>
</ul>
<h3 id="å¤šç¯å¢ƒå¤šä»½é…ç½®"><a href="#å¤šç¯å¢ƒå¤šä»½é…ç½®" class="headerlink" title="å¤šç¯å¢ƒå¤šä»½é…ç½®"></a>å¤šç¯å¢ƒå¤šä»½é…ç½®</h3><p>å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ <code>UMI_ENV</code> åŒºåˆ†ä¸åŒç¯å¢ƒæ¥æŒ‡å®šé…ç½®ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// .umirc.js æˆ–è€… config/config.jsexport default &#123; a: 1, b: 2 &#125;;</span><br><span class="hljs-comment">// .umirc.cloud.js æˆ–è€… config/config.cloud.jsexport default &#123; b: &#x27;cloud&#x27;, c: &#x27;cloud&#x27; &#125;;</span><br><span class="hljs-comment">// .umirc.local.js æˆ–è€… config/config.local.jsexport default &#123; c: &#x27;local&#x27; &#125;;</span><br></code></pre></td></tr></table></figure>

<p>ä¸æŒ‡å®š <code>UMI_ENV</code> æ—¶ï¼Œæ‹¿åˆ°çš„é…ç½®æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,<br>  <span class="hljs-attr">c</span>: <span class="hljs-string">&#x27;local&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æŒ‡å®š <code>UMI_ENV=cloud</code> æ—¶ï¼Œæ‹¿åˆ°çš„é…ç½®æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">b</span>: <span class="hljs-string">&#x27;cloud&#x27;</span>,<br>  <span class="hljs-attr">c</span>: <span class="hljs-string">&#x27;local&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="è¿è¡Œæ—¶é…ç½®"><a href="#è¿è¡Œæ—¶é…ç½®" class="headerlink" title="è¿è¡Œæ—¶é…ç½®"></a>è¿è¡Œæ—¶é…ç½®</h2><p>è¿è¡Œæ—¶é…ç½®å’Œé…ç½®çš„åŒºåˆ«æ˜¯ä»–è·‘åœ¨æµè§ˆå™¨ç«¯ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå†™å‡½æ•°ã€jsxã€import æµè§ˆå™¨ç«¯ä¾èµ–ç­‰ç­‰ï¼Œæ³¨æ„ä¸è¦å¼•å…¥ node ä¾èµ–ã€‚</p>
<h3 id="é…ç½®æ–¹å¼"><a href="#é…ç½®æ–¹å¼" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h3><p>çº¦å®š <code>src/app.tsx</code> ä¸ºè¿è¡Œæ—¶é…ç½®ã€‚</p>
<h3 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h3><h5 id="modifyClientRenderOpts-fn"><a href="#modifyClientRenderOpts-fn" class="headerlink" title="modifyClientRenderOpts(fn)"></a>modifyClientRenderOpts(fn)</h5><p>ä¿®æ”¹ clientRender å‚æ•°ã€‚</p>
<p>æ¯”å¦‚åœ¨å¾®å‰ç«¯é‡ŒåŠ¨æ€ä¿®æ”¹æ¸²æŸ“æ ¹èŠ‚ç‚¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> isSubApp = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">modifyClientRenderOpts</span>(<span class="hljs-params">memo</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    ...memo,<br>    <span class="hljs-attr">rootElement</span>: isSubApp ? <span class="hljs-string">&#x27;sub-root&#x27;</span> : memo.<span class="hljs-property">rootElement</span>,    <br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="patchRoutes-routes"><a href="#patchRoutes-routes" class="headerlink" title="patchRoutes({ routes })"></a>patchRoutes({ routes })</h5><p>ä¿®æ”¹è·¯ç”±ã€‚</p>
<p>æ¯”å¦‚åœ¨æœ€å‰é¢æ·»åŠ ä¸€ä¸ª <code>/foo</code> è·¯ç”±ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> patchRoutes(&#123; routes &#125;) &#123;<br>  routes.unshift(&#123;<br>    path: <span class="hljs-string">&#x27;/foo&#x27;</span>,<br>    exact: <span class="hljs-literal">true</span>,<br>    component: require(<span class="hljs-string">&#x27;@/extraRoutes/foo&#x27;</span>).default,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¯”å¦‚å’Œ <code>render</code> é…ç½®é…åˆä½¿ç”¨ï¼Œè¯·æ±‚æœåŠ¡ç«¯æ ¹æ®å“åº”åŠ¨æ€æ›´æ–°è·¯ç”±ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> extraRoutes;<br><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> patchRoutes(&#123; routes &#125;) &#123;  merge(routes, extraRoutes);&#125;<br><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> render(oldRender) &#123;  fetch(<span class="hljs-string">&#x27;/api/routes&#x27;</span>).<span class="hljs-keyword">then</span>(res=&gt;res.json()).<span class="hljs-keyword">then</span>((res) =&gt; &#123;     extraRoutes = res.routes;    oldRender();  &#125;)&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>ç›´æ¥ä¿®æ”¹routesï¼Œä¸éœ€è¦è¿”å›</li>
</ul>
<h5 id="render-oldRender-Function"><a href="#render-oldRender-Function" class="headerlink" title="render(oldRender: Function)"></a>render(oldRender: Function)</h5><p>è¦†å†™ renderã€‚</p>
<p>æ¯”å¦‚ç”¨äºæ¸²æŸ“ä¹‹å‰åšæƒé™æ ¡éªŒï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">import &#123; <span class="hljs-built_in">history</span> &#125; from <span class="hljs-string">&#x27;umi&#x27;</span>;<br><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> render(oldRender) &#123;  fetch(<span class="hljs-string">&#x27;/api/auth&#x27;</span>).<span class="hljs-keyword">then</span>(auth =&gt; &#123;    <span class="hljs-keyword">if</span> (auth.isLogin) &#123; oldRender() &#125;    <span class="hljs-keyword">else</span> &#123;       history.push(<span class="hljs-string">&#x27;/login&#x27;</span>);       oldRender()    &#125;  &#125;);&#125;<br></code></pre></td></tr></table></figure>

<h5 id="onRouteChange-routes-matchedRoutes-location-action"><a href="#onRouteChange-routes-matchedRoutes-location-action" class="headerlink" title="onRouteChange({ routes, matchedRoutes, location, action })"></a>onRouteChange({ routes, matchedRoutes, location, action })</h5><p>åœ¨åˆå§‹åŠ è½½å’Œè·¯ç”±åˆ‡æ¢æ—¶åšä¸€äº›äº‹æƒ…ã€‚</p>
<p>æ¯”å¦‚ç”¨äºåšåŸ‹ç‚¹ç»Ÿè®¡ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> onRouteChange(&#123; location, routes, action &#125;) &#123;<br>  bacon(location.pathname);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¯”å¦‚ç”¨äºè®¾ç½®æ ‡é¢˜ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> onRouteChange(&#123; matchedRoutes &#125;) &#123;<br>  <span class="hljs-keyword">if</span> (matchedRoutes.length) &#123;<br>    document.title = matchedRoutes[matchedRoutes.length - 1].route.title || <span class="hljs-string">&#x27;&#x27;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="rootContainer-LastRootContainer-args"><a href="#rootContainer-LastRootContainer-args" class="headerlink" title="rootContainer(LastRootContainer, args)"></a>rootContainer(LastRootContainer, args)</h5><p>ä¿®æ”¹äº¤ç»™ react-dom æ¸²æŸ“æ—¶çš„æ ¹ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚ç”¨äºåœ¨å¤–é¢åŒ…ä¸€ä¸ª Providerï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> <span class="hljs-keyword">function</span> rootContainer(container) &#123;<br>  <span class="hljs-built_in">return</span> React.createElement(ThemeProvider, null, container);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>args åŒ…å«ï¼š</p>
<ul>
<li>routesï¼Œå…¨é‡è·¯ç”±é…ç½®</li>
<li>pluginï¼Œè¿è¡Œæ—¶æ’ä»¶æœºåˆ¶</li>
<li>historyï¼Œhistory å®ä¾‹</li>
</ul>
<h3 id="æ›´å¤šé…ç½®é¡¹"><a href="#æ›´å¤šé…ç½®é¡¹" class="headerlink" title="æ›´å¤šé…ç½®é¡¹"></a>æ›´å¤šé…ç½®é¡¹</h3><p>Umi å…è®¸æ’ä»¶æ³¨å†Œè¿è¡Œæ—¶é…ç½®ï¼Œå¦‚æœä½ ä½¿ç”¨æ’ä»¶ï¼Œè‚¯å®šä¼šåœ¨æ’ä»¶é‡Œæ‰¾åˆ°æ›´å¤šè¿è¡Œæ—¶çš„é…ç½®é¡¹ã€‚</p>
<h2 id="çº¦å®šå¼è·¯ç”±"><a href="#çº¦å®šå¼è·¯ç”±" class="headerlink" title="çº¦å®šå¼è·¯ç”±"></a>çº¦å®šå¼è·¯ç”±</h2><p>é™¤é…ç½®å¼è·¯ç”±å¤–ï¼ŒUmi ä¹Ÿæ”¯æŒçº¦å®šå¼è·¯ç”±ã€‚çº¦å®šå¼è·¯ç”±ä¹Ÿå«æ–‡ä»¶è·¯ç”±ï¼Œå°±æ˜¯ä¸éœ€è¦æ‰‹å†™é…ç½®ï¼Œæ–‡ä»¶ç³»ç»Ÿå³è·¯ç”±ï¼Œé€šè¿‡ç›®å½•å’Œæ–‡ä»¶åŠå…¶å‘½ååˆ†æå‡ºè·¯ç”±é…ç½®ã€‚</p>
<p><strong>å¦‚æœæ²¡æœ‰ routes é…ç½®ï¼ŒUmi ä¼šè¿›å…¥çº¦å®šå¼è·¯ç”±æ¨¡å¼</strong>ï¼Œç„¶ååˆ†æ <code>src/pages</code> ç›®å½•æ‹¿åˆ°è·¯ç”±é…ç½®ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>  â””â”€â”€ pages<br>    â”œâ”€â”€ index.tsx<br>    â””â”€â”€ users.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°ä»¥ä¸‹è·¯ç”±é…ç½®ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users&#x27;</span> &#125;,<br>]<br></code></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ»¡è¶³ä»¥ä¸‹ä»»æ„è§„åˆ™çš„æ–‡ä»¶ä¸ä¼šè¢«æ³¨å†Œä¸ºè·¯ç”±ï¼Œ</p>
<ul>
<li>ä»¥ <code>.</code> æˆ– <code>_</code> å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•</li>
<li>ä»¥ <code>d.ts</code> ç»“å°¾çš„ç±»å‹å®šä¹‰æ–‡ä»¶</li>
<li>ä»¥ <code>test.ts</code>ã€<code>spec.ts</code>ã€<code>e2e.ts</code> ç»“å°¾çš„æµ‹è¯•æ–‡ä»¶ï¼ˆé€‚ç”¨äº <code>.js</code>ã€<code>.jsx</code> å’Œ <code>.tsx</code> æ–‡ä»¶ï¼‰</li>
<li><code>components</code> å’Œ <code>component</code> ç›®å½•</li>
<li><code>utils</code> å’Œ <code>util</code> ç›®å½•</li>
<li>ä¸æ˜¯ <code>.js</code>ã€<code>.jsx</code>ã€<code>.ts</code> æˆ– <code>.tsx</code> æ–‡ä»¶</li>
<li>æ–‡ä»¶å†…å®¹ä¸åŒ…å« JSX å…ƒç´ </li>
</ul>
<h3 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h3><p>çº¦å®š <code>[]</code> åŒ…è£¹çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸ºåŠ¨æ€è·¯ç”±ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li><code>src/pages/users/[id].tsx</code> ä¼šæˆä¸º <code>/users/:id</code></li>
<li><code>src/pages/users/[id]/settings.tsx</code> ä¼šæˆä¸º <code>/users/:id/settings</code></li>
</ul>
<p>ä¸¾ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œæ¯”å¦‚ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>  â””â”€â”€ pages<br>    â””â”€â”€ [post]<br>      â”œâ”€â”€ index.tsx<br>      â””â”€â”€ comments.tsx<br>    â””â”€â”€ <span class="hljs-built_in">users</span><br>      â””â”€â”€ [<span class="hljs-built_in">id</span>].tsx<br>    â””â”€â”€ index.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè·¯ç”±é…ç½®ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users/:id&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users/[id]&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/:post/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/[post]/index&#x27;</span> &#125;,<br>  &#123;<br>    <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/:post/comments&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/[post]/comments&#x27;</span>,<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure>

<h3 id="åŠ¨æ€å¯é€‰è·¯ç”±"><a href="#åŠ¨æ€å¯é€‰è·¯ç”±" class="headerlink" title="åŠ¨æ€å¯é€‰è·¯ç”±"></a>åŠ¨æ€å¯é€‰è·¯ç”±</h3><p>çº¦å®š <code>[ $]</code> åŒ…è£¹çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸ºåŠ¨æ€å¯é€‰è·¯ç”±ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li><code>src/pages/users/[id$].tsx</code> ä¼šæˆä¸º <code>/users/:id?</code></li>
<li><code>src/pages/users/[id$]/settings.tsx</code> ä¼šæˆä¸º <code>/users/:id?/settings</code></li>
</ul>
<p>ä¸¾ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œæ¯”å¦‚ä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>  â””â”€â”€ pages<br>    â””â”€â”€ [post$]<br>      â””â”€â”€ comments.tsx<br>    â””â”€â”€ <span class="hljs-built_in">users</span><br>      â””â”€â”€ [<span class="hljs-built_in">id</span>$].tsx<br>    â””â”€â”€ index.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè·¯ç”±é…ç½®ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users/:id?&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users/[id$]&#x27;</span> &#125;,<br>  &#123;<br>    <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/:post?/comments&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/[post$]/comments&#x27;</span>,<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure>

<h3 id="åµŒå¥—è·¯ç”±"><a href="#åµŒå¥—è·¯ç”±" class="headerlink" title="åµŒå¥—è·¯ç”±"></a>åµŒå¥—è·¯ç”±</h3><p>Umi é‡Œçº¦å®šç›®å½•ä¸‹æœ‰ <code>_layout.tsx</code> æ—¶ä¼šç”ŸæˆåµŒå¥—è·¯ç”±ï¼Œä»¥ <code>_layout.tsx</code> ä¸ºè¯¥ç›®å½•çš„ layoutã€‚layout æ–‡ä»¶éœ€è¦è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡ <code>props.children</code> æ¸²æŸ“å­ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹ç›®å½•ç»“æ„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â””â”€â”€ pages<br>    â””â”€â”€ <span class="hljs-built_in">users</span><br>        â”œâ”€â”€ _layout.tsx<br>        â”œâ”€â”€ index.tsx<br>        â””â”€â”€ list.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè·¯ç”±ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users/_layout&#x27;</span>,<br>    <span class="hljs-attr">routes</span>: [<br>      &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users/index&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users/list&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users/list&#x27;</span> &#125;,<br>    ]<br>  &#125;<br>]<br></code></pre></td></tr></table></figure>

<h3 id="å…¨å±€-layout"><a href="#å…¨å±€-layout" class="headerlink" title="å…¨å±€ layout"></a>å…¨å±€ layout</h3><p>çº¦å®š <code>src/layouts/index.tsx</code> ä¸ºå…¨å±€è·¯ç”±ã€‚è¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œå¹¶é€šè¿‡ <code>props.children</code> æ¸²æŸ“å­ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹ç›®å½•ç»“æ„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â””â”€â”€ src<br>    â”œâ”€â”€ layouts<br>    â”‚   â””â”€â”€ index.tsx<br>    â””â”€â”€ pages<br>        â”œâ”€â”€ index.tsx<br>        â””â”€â”€ users.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè·¯ç”±ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/layouts/index&#x27;</span>,<br>    <span class="hljs-attr">routes</span>: [<br>      &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users&#x27;</span> &#125;,<br>    ],<br>  &#125;,<br>]<br></code></pre></td></tr></table></figure>

<p>ä¸€ä¸ªè‡ªå®šä¹‰çš„å…¨å±€ <code>layout</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">IRouteComponentProps</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params">&#123; children, location, route, history, match &#125;: IRouteComponentProps</span>) &#123;  <span class="hljs-keyword">return</span> children&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ä¸åŒçš„å…¨å±€-layout"><a href="#ä¸åŒçš„å…¨å±€-layout" class="headerlink" title="ä¸åŒçš„å…¨å±€ layout"></a>ä¸åŒçš„å…¨å±€ layout</h3><p>ä½ å¯èƒ½éœ€è¦é’ˆå¯¹ä¸åŒè·¯ç”±è¾“å‡ºä¸åŒçš„å…¨å±€ layoutï¼ŒUmi ä¸æ”¯æŒè¿™æ ·çš„é…ç½®ï¼Œä½†ä½ ä»å¯ä»¥åœ¨ <code>src/layouts/index.tsx</code> ä¸­å¯¹ <code>location.path</code> åšåŒºåˆ†ï¼Œæ¸²æŸ“ä¸åŒçš„ layout ã€‚</p>
<p>æ¯”å¦‚æƒ³è¦é’ˆå¯¹ <code>/login</code> è¾“å‡ºç®€å•å¸ƒå±€ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) &#123;  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) &#123;    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SimpleLayout</span>&gt;</span>&#123; props.children &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">SimpleLayout</span>&gt;</span></span>  &#125;<br>  <span class="hljs-keyword">return</span> (    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>      &#123; props.children &#125;      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>    <span class="hljs-tag">&lt;/&gt;</span></span>  );&#125;<br></code></pre></td></tr></table></figure>

<h3 id="404-è·¯ç”±"><a href="#404-è·¯ç”±" class="headerlink" title="404 è·¯ç”±"></a>404 è·¯ç”±</h3><p>çº¦å®š <code>src/pages/404.tsx</code> ä¸º 404 é¡µé¢ï¼Œéœ€è¿”å› React ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹ç›®å½•ç»“æ„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â””â”€â”€ pages<br>    â”œâ”€â”€ 404.tsx<br>    â”œâ”€â”€ index.tsx<br>    â””â”€â”€ users.tsx<br></code></pre></td></tr></table></figure>

<p>ä¼šç”Ÿæˆè·¯ç”±ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">[<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/index&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">exact</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/users&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">component</span>: <span class="hljs-string">&#x27;@/pages/404&#x27;</span> &#125;,<br>]<br></code></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå¦‚æœè®¿é—® <code>/foo</code>ï¼Œ<code>/</code> å’Œ <code>/users</code> éƒ½ä¸èƒ½åŒ¹é…ï¼Œä¼š fallback åˆ° 404 è·¯ç”±ï¼Œé€šè¿‡ <code>src/pages/404.tsx</code> è¿›è¡Œæ¸²æŸ“ã€‚</p>
<h3 id="æƒé™è·¯ç”±"><a href="#æƒé™è·¯ç”±" class="headerlink" title="æƒé™è·¯ç”±"></a>æƒé™è·¯ç”±</h3><p>é€šè¿‡æŒ‡å®šé«˜é˜¶ç»„ä»¶ <code>wrappers</code> è¾¾æˆæ•ˆæœã€‚</p>
<p>å¦‚ä¸‹ï¼Œ<code>src/pages/user</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>user profile<span class="hljs-tag">&lt;/&gt;</span></span>&#125;<br><span class="hljs-title class_">User</span>.<span class="hljs-property">wrappers</span> = [<span class="hljs-string">&#x27;@/wrappers/auth&#x27;</span>]<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">User</span><br></code></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ <code>src/wrappers/auth</code> ä¸­ï¼Œ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Redirect</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (props) =&gt; &#123;  <span class="hljs-keyword">const</span> &#123; isLogin &#125; = <span class="hljs-title function_">useAuth</span>();  <span class="hljs-keyword">if</span> (isLogin) &#123;    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123; props.children &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;  &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Redirect</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span> /&gt;</span></span>;  &#125;&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œè®¿é—® <code>/user</code>ï¼Œå°±é€šè¿‡ <code>useAuth</code> åšæƒé™æ ¡éªŒï¼Œå¦‚æœé€šè¿‡ï¼Œæ¸²æŸ“ <code>src/pages/user</code>ï¼Œå¦åˆ™è·³è½¬åˆ° <code>/login</code>ï¼Œç”± <code>src/pages/login</code> è¿›è¡Œæ¸²æŸ“ã€‚</p>
<h3 id="æ‰©å±•è·¯ç”±å±æ€§"><a href="#æ‰©å±•è·¯ç”±å±æ€§" class="headerlink" title="æ‰©å±•è·¯ç”±å±æ€§"></a>æ‰©å±•è·¯ç”±å±æ€§</h3><p>æ”¯æŒåœ¨ä»£ç å±‚é€šè¿‡å¯¼å‡ºé™æ€å±æ€§çš„æ–¹å¼æ‰©å±•è·¯ç”±ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;&#125;<br><span class="hljs-title class_">HomePage</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&#x27;Home Page&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">HomePage</span>;<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„ <code>title</code> ä¼šé™„åŠ åˆ°è·¯ç”±é…ç½®ä¸­ã€‚</p>
<h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><h3 id="æ’ä»¶çš„-id-å’Œ-key"><a href="#æ’ä»¶çš„-id-å’Œ-key" class="headerlink" title="æ’ä»¶çš„ id å’Œ key"></a>æ’ä»¶çš„ id å’Œ key</h3><p>æ¯ä¸ªæ’ä»¶éƒ½ä¼šå¯¹åº”ä¸€ä¸ª id å’Œä¸€ä¸ª keyï¼Œ<strong>id æ˜¯è·¯å¾„çš„ç®€å†™</strong>ï¼Œ<strong>key æ˜¯è¿›ä¸€æ­¥ç®€åŒ–åç”¨äºé…ç½®çš„å”¯ä¸€å€¼</strong>ã€‚</p>
<p>æ¯”å¦‚æ’ä»¶ <code>/node_modules/@umijs/plugin-foo/index.js</code>ï¼Œé€šå¸¸æ¥è¯´ï¼Œå…¶ id ä¸º <code>@umijs/plugin-foo</code>ï¼Œkey ä¸º <code>foo</code>ã€‚</p>
<h3 id="å¯ç”¨æ’ä»¶"><a href="#å¯ç”¨æ’ä»¶" class="headerlink" title="å¯ç”¨æ’ä»¶"></a>å¯ç”¨æ’ä»¶</h3><p>æ’ä»¶æœ‰å¤šç§å¯ç”¨æ–¹å¼ï¼Œ</p>
<h4 id="package-json-ä¾èµ–"><a href="#package-json-ä¾èµ–" class="headerlink" title="package.json ä¾èµ–"></a>package.json ä¾èµ–</h4><p>Umi ä¼šè‡ªåŠ¨æ£€æµ‹ <code>dependencies</code> å’Œ <code>devDependencies</code> é‡Œçš„ umi æ’ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@umijs/preset-react&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ <code>@umijs/preset-react</code> ä¼šè‡ªåŠ¨è¢«æ³¨å†Œï¼Œæ— éœ€åœ¨é…ç½®é‡Œé‡å¤å£°æ˜ã€‚</p>
<h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨é…ç½®é‡Œå¯é€šè¿‡ <code>presets</code> å’Œ <code>plugins</code> é…ç½®æ’ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;./preset&#x27;</span>, <span class="hljs-string">&#x27;foo/presets&#x27;</span>],<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;./plugin&#x27;</span>],<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é€šå¸¸ç”¨äºå‡ ç§æƒ…å†µï¼š</p>
<ol>
<li>é¡¹ç›®ç›¸å¯¹è·¯å¾„çš„æ’ä»¶</li>
<li>é npm åŒ…å…¥å£æ–‡ä»¶çš„æ’ä»¶</li>
</ol>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¯·ä¸è¦é…ç½® npm åŒ…çš„æ’ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é‡å¤æ³¨å†Œçš„é”™è¯¯</li>
</ul>
<h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4><p>è¿˜å¯é€šè¿‡ç¯å¢ƒå˜é‡ <code>UMI_PRESETS</code> å’Œ <code>UMI_PLUGINS</code> æ³¨å†Œé¢å¤–æ’ä»¶ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ UMI_PRESETS=/a/b/preset.js umi dev<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>é¡¹ç›®é‡Œä¸å»ºè®®ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºåŸºäº umi çš„æ¡†æ¶äºŒæ¬¡å°è£…</li>
</ul>
<h3 id="æ£€æŸ¥æ’ä»¶æ³¨å†Œæƒ…å†µ"><a href="#æ£€æŸ¥æ’ä»¶æ³¨å†Œæƒ…å†µ" class="headerlink" title="æ£€æŸ¥æ’ä»¶æ³¨å†Œæƒ…å†µ"></a>æ£€æŸ¥æ’ä»¶æ³¨å†Œæƒ…å†µ</h3><h4 id="é€šè¿‡å‘½ä»¤è¡Œ"><a href="#é€šè¿‡å‘½ä»¤è¡Œ" class="headerlink" title="é€šè¿‡å‘½ä»¤è¡Œ"></a>é€šè¿‡å‘½ä»¤è¡Œ</h4><p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi plugin list<br><span class="hljs-comment"># é¡ºä¾¿çœ‹çœ‹ä»–ä»¬åˆ†åˆ«ç”¨äº†å“ªäº› key$ umi plugin list --key</span><br></code></pre></td></tr></table></figure>

<p>ç»“æœé€šå¸¸å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Plugins:<br>    - @umijs/preset-built-in [key: builtIn] (preset)    - @@/registerMethods [key: registerMethods]    - @@/routes [key: routes]    - @@/generateFiles/core/history [key: <span class="hljs-built_in">history</span>]    - @@/generateFiles/core/plugin [key: plugin]    - @@/generateFiles/core/routes [key: routes]    - ...<br></code></pre></td></tr></table></figure>

<h4 id="åœ¨æ’ä»¶é‡Œæ„ŸçŸ¥å…¶ä»–æ’ä»¶"><a href="#åœ¨æ’ä»¶é‡Œæ„ŸçŸ¥å…¶ä»–æ’ä»¶" class="headerlink" title="åœ¨æ’ä»¶é‡Œæ„ŸçŸ¥å…¶ä»–æ’ä»¶"></a>åœ¨æ’ä»¶é‡Œæ„ŸçŸ¥å…¶ä»–æ’ä»¶</h4><p>å¯é€šè¿‡ <code>api.hasPlugins(pluginId[])</code> å’Œ <code>api.hasPresets(pluginId[])</code> çš„æ–¹å¼æ„ŸçŸ¥å…¶ä»–æ’ä»¶ï¼Œè¯¦è§æ’ä»¶ APIã€‚</p>
<h3 id="ç¦ç”¨æ’ä»¶"><a href="#ç¦ç”¨æ’ä»¶" class="headerlink" title="ç¦ç”¨æ’ä»¶"></a>ç¦ç”¨æ’ä»¶</h3><p>æœ‰ä¸¤ç§æ–¹å¼å¯ç¦ç”¨æ’ä»¶ï¼Œ</p>
<h4 id="é…ç½®-key-ä¸º-false"><a href="#é…ç½®-key-ä¸º-false" class="headerlink" title="é…ç½® key ä¸º false"></a>é…ç½® key ä¸º false</h4><p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">mock</span>: <span class="hljs-literal">false</span>,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¼šç¦ç”¨ Umi å†…ç½®çš„ mock æ’ä»¶åŠå…¶åŠŸèƒ½ã€‚</p>
<h4 id="åœ¨æ’ä»¶é‡Œç¦ç”¨å…¶ä»–æ’ä»¶"><a href="#åœ¨æ’ä»¶é‡Œç¦ç”¨å…¶ä»–æ’ä»¶" class="headerlink" title="åœ¨æ’ä»¶é‡Œç¦ç”¨å…¶ä»–æ’ä»¶"></a>åœ¨æ’ä»¶é‡Œç¦ç”¨å…¶ä»–æ’ä»¶</h4><p>å¯é€šè¿‡ <code>api.skipPlugins(pluginId[])</code> çš„æ–¹å¼ç¦ç”¨ï¼Œè¯¦è§æ’ä»¶ APIã€‚</p>
<h3 id="é…ç½®æ’ä»¶"><a href="#é…ç½®æ’ä»¶" class="headerlink" title="é…ç½®æ’ä»¶"></a>é…ç½®æ’ä»¶</h3><p>é€šè¿‡æ’ä»¶çš„ key æ¥é…ç½®æ’ä»¶ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">mock</span>: &#123; <span class="hljs-attr">exclude</span>: [<span class="hljs-string">&#x27;./foo&#x27;</span>] &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ mock æ˜¯ mock æ’ä»¶çš„ keyã€‚</p>
<p>å†æ¯”å¦‚æˆ‘ä»¬å®‰è£…ä¸€ä¸ªæ’ä»¶ <code>umi-plugin-bar</code>ï¼Œå…¶ key é»˜è®¤æ˜¯ <code>bar</code>ï¼Œå°±å¯ä»¥è¿™ä¹ˆé…ç½®ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">bar</span>: &#123; ...balabala &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Mock-æ•°æ®"><a href="#Mock-æ•°æ®" class="headerlink" title="Mock æ•°æ®"></a>Mock æ•°æ®</h2><p>Mock æ•°æ®æ˜¯å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œæ˜¯åˆ†ç¦»å‰åç«¯å¼€å‘çš„å…³é”®é“¾è·¯ã€‚é€šè¿‡é¢„å…ˆè·ŸæœåŠ¡å™¨ç«¯çº¦å®šå¥½çš„æ¥å£ï¼Œæ¨¡æ‹Ÿè¯·æ±‚æ•°æ®ç”šè‡³é€»è¾‘ï¼Œèƒ½å¤Ÿè®©å‰ç«¯å¼€å‘ç‹¬ç«‹è‡ªä¸»ï¼Œä¸ä¼šè¢«æœåŠ¡ç«¯çš„å¼€å‘æ‰€é˜»å¡ã€‚</p>
<h3 id="çº¦å®šå¼-Mock-æ–‡ä»¶"><a href="#çº¦å®šå¼-Mock-æ–‡ä»¶" class="headerlink" title="çº¦å®šå¼ Mock æ–‡ä»¶"></a>çº¦å®šå¼ Mock æ–‡ä»¶</h3><p>Umi çº¦å®š <code>/mock</code> æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸º mock æ–‡ä»¶ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>â”œâ”€â”€ mock<br>    â”œâ”€â”€ api.ts<br>    â””â”€â”€ users.ts<br>â””â”€â”€ src<br>    â””â”€â”€ pages<br>        â””â”€â”€ index.tsx<br></code></pre></td></tr></table></figure>

<p><code>/mock</code> ä¸‹çš„ <code>api.ts</code> å’Œ <code>users.ts</code> ä¼šè¢«è§£æä¸º mock æ–‡ä»¶ã€‚</p>
<h3 id="ç¼–å†™-Mock-æ–‡ä»¶"><a href="#ç¼–å†™-Mock-æ–‡ä»¶" class="headerlink" title="ç¼–å†™ Mock æ–‡ä»¶"></a>ç¼–å†™ Mock æ–‡ä»¶</h3><p>å¦‚æœ <code>/mock/api.ts</code> çš„å†…å®¹å¦‚ä¸‹ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  <span class="hljs-comment">// æ”¯æŒå€¼ä¸º Object å’Œ Array  &#x27;GET /api/users&#x27;: &#123; users: [1, 2] &#125;,</span><br>  <span class="hljs-comment">// GET å¯å¿½ç•¥  &#x27;/api/users/1&#x27;: &#123; id: 1 &#125;,</span><br>  <span class="hljs-comment">// æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼ŒAPI å‚è€ƒ express@4  &#x27;POST /api/users/create&#x27;: (req, res) =&gt; &#123;    // æ·»åŠ è·¨åŸŸè¯·æ±‚å¤´    res.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;);    res.end(&#x27;ok&#x27;);  &#125;,&#125;</span><br></code></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—® <code>/api/users</code> å°±èƒ½å¾—åˆ° <code>&#123; users: [1,2] &#125;</code> çš„å“åº”ï¼Œå…¶ä»–ä»¥æ­¤ç±»æ¨ã€‚</p>
<h3 id="é…ç½®-Mock"><a href="#é…ç½®-Mock" class="headerlink" title="é…ç½® Mock"></a>é…ç½® Mock</h3><p>è¯¦è§<a target="_blank" rel="noopener" href="https://v3.umijs.org/config#mock">é…ç½®#mock</a>ã€‚</p>
<h3 id="å¦‚ä½•å…³é—­-Mockï¼Ÿ"><a href="#å¦‚ä½•å…³é—­-Mockï¼Ÿ" class="headerlink" title="å¦‚ä½•å…³é—­ Mockï¼Ÿ"></a>å¦‚ä½•å…³é—­ Mockï¼Ÿ</h3><p>å¯ä»¥é€šè¿‡é…ç½®å…³é—­ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">mock</span>: <span class="hljs-literal">false</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¸´æ—¶å…³é—­ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ MOCK=none umi dev<br></code></pre></td></tr></table></figure>

<h3 id="å¼•å…¥-Mock-js"><a href="#å¼•å…¥-Mock-js" class="headerlink" title="å¼•å…¥ Mock.js"></a>å¼•å…¥ Mock.js</h3><p><a target="_blank" rel="noopener" href="http://mockjs.com/">Mock.js</a> æ˜¯å¸¸ç”¨çš„è¾…åŠ©ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„ä¸‰æ–¹åº“ï¼Œå€ŸåŠ©ä»–å¯ä»¥æå‡æˆ‘ä»¬çš„ mock æ•°æ®èƒ½åŠ›ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> mockjs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;mockjs&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;  <span class="hljs-comment">// ä½¿ç”¨ mockjs ç­‰ä¸‰æ–¹åº“  &#x27;GET /api/tags&#x27;: mockjs.mock(&#123;    &#x27;list|100&#x27;: [&#123; name: &#x27;@city&#x27;, &#x27;value|1-100&#x27;: 50, &#x27;type|0-2&#x27;: 1 &#125;],  &#125;),&#125;;</span><br></code></pre></td></tr></table></figure>

<h2 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h2><h3 id="umi-build"><a href="#umi-build" class="headerlink" title="umi build"></a>umi build</h3><p>ç¼–è¯‘æ„å»º web äº§ç‰©ã€‚é€šå¸¸éœ€è¦é’ˆå¯¹éƒ¨ç½²ç¯å¢ƒï¼Œåšç‰¹å®šçš„é…ç½®å’Œç¯å¢ƒå˜é‡ä¿®æ”¹ã€‚ç›¸å…³è¯¦æƒ…ï¼Œè¯·æŸ¥é˜…<a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/docs/deployment">éƒ¨ç½²</a>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi build<br>âœ” Webpack  Compiled successfully <span class="hljs-keyword">in</span> 5.54s<br>  DONE  Compiled successfully <span class="hljs-keyword">in</span> 5547ms<br>Build success.âœ¨  Done <span class="hljs-keyword">in</span> 9.77s.<br></code></pre></td></tr></table></figure>

<p>é»˜è®¤äº§ç‰©è¾“å‡ºåˆ°é¡¹ç›®çš„ <code>dist</code> æ–‡ä»¶å¤¹ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½® <code>outputPath</code> æŒ‡å®šäº§ç‰©è¾“å‡ºç›®å½•ã€‚ é»˜è®¤ç¼–è¯‘æ—¶ä¼šå°† <code>public</code> æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŸæ ·æ‹·è´åˆ° <code>dist</code> ç›®å½•ï¼Œå¦‚æœä½ ä¸éœ€è¦è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡é…ç½® <code>chainWebpack</code> æ¥åˆ é™¤å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">chainWebpack</span>(<span class="hljs-params">memo, &#123; env, webpack &#125;</span>) &#123;<br>    <span class="hljs-comment">// åˆ é™¤ umi å†…ç½®æ’ä»¶</span><br>    memo.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;copy&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœ <code>public</code> é‡Œé¢å­˜åœ¨äº§ç‰©åŒåæ–‡ä»¶ï¼Œå¦‚ <code>index.html</code>ï¼Œå°†ä¼šå¯¼è‡´äº§ç‰©æ–‡ä»¶è¢«è¦†ç›–ã€‚</p>
</blockquote>
<h3 id="umi-dev"><a href="#umi-dev" class="headerlink" title="umi dev"></a>umi dev</h3><p>å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨è¿›è¡Œé¡¹ç›®çš„å¼€å‘è°ƒè¯•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi dev<br></code></pre></td></tr></table></figure>

<p>å¯åŠ¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„å¼€å‘æœåŠ¡å™¨ï¼Œå¹¶ç›‘è§†æºæ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨çƒ­åŠ è½½ã€‚</p>
<p>é»˜è®¤ä½¿ç”¨ <code>8000</code> ç«¯å£ï¼Œå¦‚æœ <code>8000</code> ç«¯å£è¢«å ç”¨ï¼Œå°†ä¼šä½¿ç”¨ <code>8001</code> ç«¯å£ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>PORT</code> æ¥æŒ‡å®šå¼€å‘ç«¯å£å·ã€‚æ›´å¤šç¯å¢ƒå˜é‡é…ç½®ï¼Œè¯·æŸ¥é˜…<a target="_blank" rel="noopener" href="https://v3.umijs.org/docs/env-variables">ç¯å¢ƒå˜é‡</a>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">umi devStarting the development server...<br>âœ” Webpack  Compiled successfully <span class="hljs-keyword">in</span> 2.27s<br>  DONE  Compiled successfully <span class="hljs-keyword">in</span> 2276ms<br>  App running at:  - Local:   http://localhost:8000 (copied to clipboard)  - Network: http://192.168.50.236:8000<br></code></pre></td></tr></table></figure>

<p>å¼€å¯å¼€å‘æœåŠ¡è¿˜ä¼šåŒæ—¶æä¾›ä¸€ä¸ª Network çš„é“¾æ¥ï¼Œä½ å¯ä»¥åœ¨èƒ½è®¿é—®åˆ°ä½ å½“å‰è¿è¡Œè®¾å¤‡çš„å…¶ä»–è®¾å¤‡ä¸­é¢„è§ˆé¡µé¢ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ˜¯åœ¨å¼€å¯äº†VPNï¼Œæˆ–è€…è™šæ‹Ÿæœºç­‰å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œè¿™ä¸ªåœ°å€å¾ˆå¯èƒ½ä¼šé”™è¯¯ã€‚ä½ å¯ä»¥é€šè¿‡è®¿é—®ä½ çœŸå®å¯ç”¨ <code>ip</code> çš„å¯¹åº”ç«¯å£å·æ¥è®¿é—®å¼€å‘é¡µé¢ã€‚</p>
</blockquote>
<h3 id="umi-generate"><a href="#umi-generate" class="headerlink" title="umi generate"></a>umi generate</h3><p>å†…ç½®çš„ç”Ÿæˆå™¨åŠŸèƒ½ï¼Œå†…ç½®çš„ç±»å‹æœ‰ <code>page</code> ï¼Œç”¨äºç”Ÿæˆæœ€ç®€é¡µé¢ã€‚æ”¯æŒåˆ«åè°ƒç”¨ <code>umi g</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi generate &lt;<span class="hljs-built_in">type</span>&gt; &lt;name&gt; [options]<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤æ”¯æŒæ‰©å±•ï¼Œé€šè¿‡ <code>api.registerGenerator</code> æ³¨å†Œï¼Œä½ å¯ä»¥é€šè¿‡æ’ä»¶æ¥å®ç°è‡ªå·±å¸¸ç”¨çš„ç”Ÿæˆå™¨ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Generator</span>, <span class="hljs-title class_">IApi</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span>;<br><span class="hljs-keyword">const</span> createPagesGenerator = <span class="hljs-keyword">function</span> (<span class="hljs-params">&#123; api &#125;: &#123; api: IApi &#125;</span>) &#123;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageGenerator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Generator</span> &#123;    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">opts: <span class="hljs-built_in">any</span></span>) &#123;      <span class="hljs-variable language_">super</span>(opts);    &#125;    <span class="hljs-keyword">async</span> <span class="hljs-title function_">writing</span>(<span class="hljs-params"></span>) &#123;&#125;  &#125;;&#125;<br>api.<span class="hljs-title function_">registerGenerator</span>(&#123;  <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;pages&#x27;</span>,  <span class="hljs-title class_">Generator</span>: <span class="hljs-title function_">createPageGenerator</span>(&#123; api &#125;),&#125;);<br>umi generate page pageName<br>umi generate page pageName --typescript<br>umi generate page pageName --less<br></code></pre></td></tr></table></figure>

<p>æ›´å¤šä½¿ç”¨ç±»å‹å’Œå‚æ•°ï¼Œè¯·æŸ¥é˜…æä¾›ç”Ÿæˆå™¨æ‰©å±•çš„æ’ä»¶çš„æ–‡æ¡£ã€‚</p>
<h3 id="umi-plugin"><a href="#umi-plugin" class="headerlink" title="umi plugin"></a>umi plugin</h3><p>å¿«é€ŸæŸ¥çœ‹å½“å‰é¡¹ç›®ä½¿ç”¨åˆ°çš„æ‰€æœ‰çš„ <code>umi</code> æ’ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi plugin &lt;<span class="hljs-built_in">type</span>&gt; [options]<br></code></pre></td></tr></table></figure>

<p>å½“å‰æ”¯æŒçš„ <code>type</code> æ˜¯ <code>list</code>ï¼Œå¯é€‰å‚æ•° <code>key</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi plugin list<br>Plugins:<br>  - @umijs/preset-built-in (preset)  - ./node_modules/umi/lib/plugins/umiAlias<br>âœ¨  Done <span class="hljs-keyword">in</span> 2.27s.<br>$ umi plugin list --key<br>Plugins:<br>  - @umijs/preset-built-in [key: builtIn]  (preset)  - ./node_modules/umi/lib/plugins/umiAlias  [key: builtIn]<br>âœ¨  Done <span class="hljs-keyword">in</span> 2.27s.<br></code></pre></td></tr></table></figure>

<h3 id="umi-help"><a href="#umi-help" class="headerlink" title="umi help"></a>umi help</h3><p>umi å‘½ä»¤è¡Œçš„ç®€æ˜“å¸®åŠ©æ–‡æ¡£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi <span class="hljs-built_in">help</span> &lt;<span class="hljs-built_in">command</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="umi-version"><a href="#umi-version" class="headerlink" title="umi version"></a>umi version</h3><p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ umi çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥ä½¿ç”¨åˆ«å <code>-v</code> è°ƒç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi version<br>$ umi -v<br></code></pre></td></tr></table></figure>

<h3 id="umi-webpack"><a href="#umi-webpack" class="headerlink" title="umi webpack"></a>umi webpack</h3><p>æŸ¥çœ‹ umi ä½¿ç”¨çš„ webpack é…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi webpack [options]<br></code></pre></td></tr></table></figure>

<p>å‚æ•°ï¼Œ</p>
<table>
<thead>
<tr>
<th>å¯é€‰å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>rules</td>
<td>æŸ¥çœ‹ webpack.module.rules é…ç½®è¯¦æƒ…</td>
</tr>
<tr>
<td>rule&#x3D;[name]</td>
<td>æŸ¥çœ‹ webpack.module.rules ä¸­æŸä¸ªè§„åˆ™çš„é…ç½®è¯¦æƒ…</td>
</tr>
<tr>
<td>plugins</td>
<td>æŸ¥çœ‹ webpack.plugins é…ç½®è¯¦æƒ…</td>
</tr>
<tr>
<td>plugin&#x3D;[name]</td>
<td>æŸ¥çœ‹ webpack.plugins ä¸­æŸä¸ªæ’ä»¶çš„é…ç½®è¯¦æƒ…</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ umi webpack<br>&#123;  mode: <span class="hljs-string">&#x27;development&#x27;</span>,  devtool: <span class="hljs-string">&#x27;cheap-module-source-map&#x27;</span>,  node:&#123; &#125;,  output:&#123; &#125;,  resolve:&#123; &#125;,  module:&#123;    rules:[ ]  &#125;,  plugins:[ ],  entry:&#123; &#125;&#125;<br>$ umi webpack --rules<br>[  <span class="hljs-string">&#x27;js&#x27;</span>,  <span class="hljs-string">&#x27;ts-in-node_modules&#x27;</span>,  <span class="hljs-string">&#x27;js-in-node_modules&#x27;</span>,  <span class="hljs-string">&#x27;images&#x27;</span>,  <span class="hljs-string">&#x27;svg&#x27;</span>,  <span class="hljs-string">&#x27;fonts&#x27;</span>,  <span class="hljs-string">&#x27;plaintext&#x27;</span>,  <span class="hljs-string">&#x27;css&#x27;</span>,  <span class="hljs-string">&#x27;less&#x27;</span>]<br>$ umi webpack --rule=js<br>&#123;  <span class="hljs-built_in">test</span>: /\.(js|mjs|jsx|ts|tsx)$/,  include: [ <span class="hljs-string">&#x27;xx/umi&#x27;</span> ],  exclude: [ /node_modules/ ],  use:[    &#123;      loader:<span class="hljs-string">&#x27;xx/babel-loader/lib/index.js&#x27;</span>,      options: &#123;        sourceType: <span class="hljs-string">&#x27;unambiguous&#x27;</span>      &#125;    &#125;  ]&#125;<br>$ umi webpack --plugins<br>[  <span class="hljs-string">&#x27;extract-css&#x27;</span>,  <span class="hljs-string">&#x27;define&#x27;</span>,  <span class="hljs-string">&#x27;progress&#x27;</span>,  <span class="hljs-string">&#x27;copy&#x27;</span>,  <span class="hljs-string">&#x27;friendly-error&#x27;</span>,  <span class="hljs-string">&#x27;hmr&#x27;</span>]<br>$ umi webpack --plugin=extract-css<br>MiniCssExtractPlugin &#123;  options:&#123;    filename: <span class="hljs-string">&#x27;[name].css&#x27;</span>,    moduleFilename: [Function: moduleFilename],    ignoreOrder: <span class="hljs-literal">true</span>,    chunkFilename: <span class="hljs-string">&#x27;[name].chunk.css&#x27;</span>  &#125;&#125;<br></code></pre></td></tr></table></figure>

<p>é»˜è®¤ä¼šæ‰“å° development çš„é…ç½®ï¼Œå¦‚éœ€æŸ¥çœ‹ production é…ç½®ï¼Œéœ€è¦æŒ‡å®šç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ NODE_ENV=production umi webpack<br>&#123;  mode: <span class="hljs-string">&#x27;production&#x27;</span>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨-CSS"><a href="#ä½¿ç”¨-CSS" class="headerlink" title="ä½¿ç”¨ CSS"></a>ä½¿ç”¨ CSS</h2><blockquote>
<p>æœ¬æ–‡æ¡£ä»¥ css ä¸ºç¤ºä¾‹ï¼ŒæŠŠåç¼€æ¢æˆ <code>.less</code> åŒæ ·é€‚ç”¨ã€‚</p>
</blockquote>
<h3 id="å…¨å±€æ ·å¼"><a href="#å…¨å±€æ ·å¼" class="headerlink" title="å…¨å±€æ ·å¼"></a>å…¨å±€æ ·å¼</h3><p>Umi ä¸­çº¦å®š <code>src/global.css</code> ä¸ºå…¨å±€æ ·å¼ï¼Œå¦‚æœå­˜åœ¨æ­¤æ–‡ä»¶ï¼Œä¼šè¢«è‡ªåŠ¨å¼•å…¥åˆ°å…¥å£æ–‡ä»¶æœ€å‰é¢ã€‚</p>
<p>æ¯”å¦‚ç”¨äºè¦†ç›–æ ·å¼ï¼Œ</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.ant-select-selection</span> &#123;<br>  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">51px</span>;<br>  <span class="hljs-attribute">overflow</span>: auto;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="CSS-Modules"><a href="#CSS-Modules" class="headerlink" title="CSS Modules"></a>CSS Modules</h3><p>Umi ä¼šè‡ªåŠ¨è¯†åˆ« CSS Modules çš„ä½¿ç”¨ï¼Œä½ æŠŠä»–å½“åš CSS Modules ç”¨æ—¶æ‰æ˜¯ CSS Modulesã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// CSS Modulesimport styles from &#x27;./foo.css&#x27;;</span><br><span class="hljs-comment">// é CSS Modulesimport &#x27;./foo.css&#x27;;</span><br></code></pre></td></tr></table></figure>

<h3 id="CSS-é¢„å¤„ç†å™¨"><a href="#CSS-é¢„å¤„ç†å™¨" class="headerlink" title="CSS é¢„å¤„ç†å™¨"></a>CSS é¢„å¤„ç†å™¨</h3><p>Umi å†…ç½®æ”¯æŒ lessï¼Œä¸æ”¯æŒ sass å’Œ stylusï¼Œä½†å¦‚æœæœ‰éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡ chainWebpack é…ç½®æˆ–è€… umi æ’ä»¶çš„å½¢å¼æ”¯æŒã€‚</p>
<h3 id="CSS-ä¸­å¼•å…¥ä¸‰æ–¹åº“"><a href="#CSS-ä¸­å¼•å…¥ä¸‰æ–¹åº“" class="headerlink" title="CSS ä¸­å¼•å…¥ä¸‰æ–¹åº“"></a>CSS ä¸­å¼•å…¥ä¸‰æ–¹åº“</h3><p>TODOï¼šåˆ«åçš„ä½¿ç”¨ã€‚</p>
<h2 id="ä½¿ç”¨å›¾ç‰‡"><a href="#ä½¿ç”¨å›¾ç‰‡" class="headerlink" title="ä½¿ç”¨å›¾ç‰‡"></a>ä½¿ç”¨å›¾ç‰‡</h2><h3 id="JS-é‡Œä½¿ç”¨å›¾ç‰‡"><a href="#JS-é‡Œä½¿ç”¨å›¾ç‰‡" class="headerlink" title="JS é‡Œä½¿ç”¨å›¾ç‰‡"></a>JS é‡Œä½¿ç”¨å›¾ç‰‡</h3><p>é€šè¿‡ require å¼•ç”¨ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;require(</span>&#x27;<span class="hljs-attr">.</span>/<span class="hljs-attr">foo.png</span>&#x27;)&#125; /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>æ”¯æŒåˆ«åï¼Œæ¯”å¦‚é€šè¿‡ <code>@</code> æŒ‡å‘ src ç›®å½•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;require(</span>&#x27;@/<span class="hljs-attr">foo.png</span>&#x27;)&#125; /&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="JS-é‡Œä½¿ç”¨svg"><a href="#JS-é‡Œä½¿ç”¨svg" class="headerlink" title="JS é‡Œä½¿ç”¨svg"></a>JS é‡Œä½¿ç”¨svg</h3><p><strong>ç»„ä»¶å¼å¼•å…¥</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ReactComponent</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Logo</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./logo.svg&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Analysis</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Logo</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;90&#125;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;120&#125;</span> /&gt;</span></span>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>urlå¼å¼•å…¥</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> logoSrc <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./logo.svg&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Analysis</span>(<span class="hljs-params"></span>) &#123;  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;logoSrc&#125;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;logo&quot;</span> /&gt;</span></span>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="CSS-é‡Œä½¿ç”¨å›¾ç‰‡"><a href="#CSS-é‡Œä½¿ç”¨å›¾ç‰‡" class="headerlink" title="CSS é‡Œä½¿ç”¨å›¾ç‰‡"></a>CSS é‡Œä½¿ç”¨å›¾ç‰‡</h3><p>é€šè¿‡ç›¸å¯¹è·¯å¾„å¼•ç”¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œ</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.logo</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">./foo.png</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>CSS é‡Œä¹Ÿæ”¯æŒåˆ«åï¼Œä½†éœ€è¦åœ¨å‰é¢åŠ  <code>~</code> å‰ç¼€ï¼Œ</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.logo</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">~@/foo.png</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ol>
<li>è¿™æ˜¯ webpack çš„è§„åˆ™ï¼Œå¦‚æœåˆ‡åˆ°å…¶ä»–æ‰“åŒ…å·¥å…·ï¼Œå¯èƒ½ä¼šæœ‰å˜åŒ–</li>
<li>less ä¸­åŒæ ·é€‚ç”¨</li>
</ol>
<h3 id="å›¾ç‰‡è·¯å¾„é—®é¢˜"><a href="#å›¾ç‰‡è·¯å¾„é—®é¢˜" class="headerlink" title="å›¾ç‰‡è·¯å¾„é—®é¢˜"></a>å›¾ç‰‡è·¯å¾„é—®é¢˜</h3><p>é¡¹ç›®ä¸­ä½¿ç”¨å›¾ç‰‡æœ‰ä¸¤ç§æ–¹å¼ï¼Œ</p>
<ol>
<li>å…ˆæŠŠå›¾ç‰‡ä¼ åˆ° cdnï¼Œç„¶ååœ¨ JS å’Œ CSS ä¸­ä½¿ç”¨å›¾ç‰‡çš„ç»å¯¹è·¯å¾„</li>
<li>æŠŠå›¾ç‰‡æ”¾åœ¨é¡¹ç›®é‡Œï¼Œç„¶ååœ¨ JS å’Œ CSS ä¸­é€šè¿‡ç›¸å¯¹è·¯å¾„çš„æ–¹å¼ä½¿ç”¨</li>
</ol>
<p>å‰è€…ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼›åè€…ï¼Œå¦‚æœåœ¨ JS ä¸­å¼•ç”¨ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡æ—¶ï¼Œåœ¨å‘å¸ƒæ—¶ä¼šæ ¹æ® publicPath å¼•å…¥ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥å°±ç®—æ²¡æœ‰å¼€å¯ dynamicImport æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„ publicPath çš„æ­£ç¡®æ€§ã€‚</p>
<h3 id="Base64-ç¼–è¯‘"><a href="#Base64-ç¼–è¯‘" class="headerlink" title="Base64 ç¼–è¯‘"></a>Base64 ç¼–è¯‘</h3><p>é€šè¿‡ç›¸å¯¹è·¯å¾„å¼•å…¥å›¾ç‰‡çš„æ—¶å€™ï¼Œå¦‚æœå›¾ç‰‡å°äº 10Kï¼Œä¼šè¢«ç¼–è¯‘ä¸º Base64ï¼Œå¦åˆ™ä¼šè¢«æ„å»ºä¸ºç‹¬ç«‹çš„å›¾ç‰‡æ–‡ä»¶ã€‚</p>
<p>10K è¿™ä¸ªé˜ˆå€¼å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config#inlinelimit">inlineLimit é…ç½®</a>ä¿®æ”¹ã€‚</p>
<h3 id="ä½¿ç”¨-CDN"><a href="#ä½¿ç”¨-CDN" class="headerlink" title="ä½¿ç”¨ CDN"></a>ä½¿ç”¨ CDN</h3><p>TODO</p>
<h2 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h2><h3 id="å¯ç”¨æŒ‰éœ€åŠ è½½"><a href="#å¯ç”¨æŒ‰éœ€åŠ è½½" class="headerlink" title="å¯ç”¨æŒ‰éœ€åŠ è½½"></a>å¯ç”¨æŒ‰éœ€åŠ è½½</h3><p><strong>å¸¸è§ä½¿ç”¨åœºæ™¯</strong>ï¼šç»„ä»¶ä½“ç§¯å¤ªå¤§ï¼Œä¸é€‚åˆç›´æ¥è®¡å…¥ bundle ä¸­ï¼Œä»¥å…å½±å“é¦–å±åŠ è½½é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼šæŸç»„ä»¶ HugeA åŒ…å«å·¨å¤§çš„å®ç° &#x2F; ä¾èµ–äº†å·¨å¤§çš„ä¸‰æ–¹åº“ï¼Œä¸”è¯¥ç»„ä»¶ HugeA çš„ä½¿ç”¨ä¸åœ¨é¦–å±æ˜¾ç¤ºèŒƒå›´å†…ï¼Œå¯è¢«å•ç‹¬æ‹†å‡ºã€‚è¿™æ—¶å€™ï¼Œ<code>dynamic</code> å°±è¯¥ä¸Šåœºäº†ã€‚</p>
<p>ä¸ºäº†ç®€åŒ–éƒ¨ç½²æˆæœ¬ï¼ŒæŒ‰éœ€åŠ è½½åŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ï¼Œä½ éœ€è¦åœ¨ä½¿ç”¨ä¹‹å‰å…ˆé€šè¿‡é…ç½®å¼€å¯ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">dynamicImport</span>: &#123;&#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æŒ‰éœ€åŠ è½½"><a href="#ä½¿ç”¨æŒ‰éœ€åŠ è½½" class="headerlink" title="ä½¿ç”¨æŒ‰éœ€åŠ è½½"></a>ä½¿ç”¨æŒ‰éœ€åŠ è½½</h3><h4 id="æŒ‰éœ€åŠ è½½ç»„ä»¶-dynamic"><a href="#æŒ‰éœ€åŠ è½½ç»„ä»¶-dynamic" class="headerlink" title="æŒ‰éœ€åŠ è½½ç»„ä»¶ dynamic"></a>æŒ‰éœ€åŠ è½½ç»„ä»¶ <code>dynamic</code></h4><p>**ä¸ºä»€ä¹ˆä½¿ç”¨ <code>dynamic</code>**ï¼šå°è£…äº†ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶éœ€è¦åšçš„çŠ¶æ€ç»´æŠ¤å·¥ä½œï¼Œå¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡ç»„ä»¶å¼€å‘ï¼Œè€Œä¸å¿…å…³å¿ƒ code splitingã€async module loading ç­‰ç­‰æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>é€šå¸¸æ­é… <a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-dynamic-import">åŠ¨æ€ import è¯­æ³•</a> ä½¿ç”¨ã€‚</p>
<p><strong>å°è£…ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; dynamic &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;umi&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">dynamic</span>(&#123;  <span class="hljs-attr">loader</span>: <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-comment">// è¿™é‡Œçš„æ³¨é‡Š webpackChunkName å¯ä»¥æŒ‡å¯¼ webpack å°†è¯¥ç»„ä»¶ HugeA ä»¥è¿™ä¸ªåå­—å•ç‹¬æ‹†å‡ºå»    const &#123; default: HugeA &#125; = await import(/* webpackChunkName: &quot;external_A&quot; */ &#x27;./HugeA&#x27;);    return HugeA;  &#125;,&#125;);</span><br></code></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨å¼‚æ­¥ç»„ä»¶</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<span class="hljs-keyword">import</span> <span class="hljs-title class_">AsyncHugeA</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AsyncHugeA&#x27;</span>;<br><span class="hljs-comment">// åƒä½¿ç”¨æ™®é€šç»„ä»¶ä¸€æ ·å³å¯// dynamic ä¸ºä½ åš:// 1. å¼‚æ­¥åŠ è½½è¯¥æ¨¡å—çš„ bundle// 2. åŠ è½½æœŸé—´ æ˜¾ç¤º loadingï¼ˆå¯å®šåˆ¶ï¼‰// 3. å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæ¯•åï¼Œæ˜¾ç¤ºå¼‚æ­¥ç»„ä»¶export default () =&gt; &#123;  return &lt;AsyncHugeA /&gt;;&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="å¿«é€Ÿåˆ·æ–°ï¼ˆFast-Refreshï¼‰"><a href="#å¿«é€Ÿåˆ·æ–°ï¼ˆFast-Refreshï¼‰" class="headerlink" title="å¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰"></a>å¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰</h2><blockquote>
<p>å¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰æ˜¯ React å®˜æ–¹ä¸º React Native å¼€å‘çš„æ¨¡å—çƒ­æ›¿æ¢ï¼ˆHMRï¼‰æ–¹æ¡ˆï¼Œç”±äºå…¶æ ¸å¿ƒå®ç°ä¸å¹³å°æ— å…³ï¼ŒåŒæ—¶ä¹Ÿé€‚ç”¨äº Webã€‚</p>
</blockquote>
<p>Fast Refresh åŠŸèƒ½æœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼šå¼€å‘ç¯å¢ƒä¸‹ï¼Œå¯ä»¥<strong>ä¿æŒç»„ä»¶çŠ¶æ€</strong>ï¼ŒåŒæ—¶ç¼–è¾‘æä¾›<strong>å³æ—¶åé¦ˆ</strong>ã€‚</p>
<h3 id="æ€æ ·ä½¿ç”¨ï¼Ÿ"><a href="#æ€æ ·ä½¿ç”¨ï¼Ÿ" class="headerlink" title="æ€æ ·ä½¿ç”¨ï¼Ÿ"></a>æ€æ ·ä½¿ç”¨ï¼Ÿ</h3><p>åœ¨<a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/docs/config">é…ç½®æ–‡ä»¶</a>åŠ ä¸Š <code>fastRefresh: &#123;&#125;</code> å³å¯å¼€å¯</p>
<p>è¿™å¼  gif åŠ¨å›¾å±•ç¤ºçš„æ˜¯ä½¿ç”¨ Fast Refresh ç‰¹æ€§çš„å¼€å‘ä½“éªŒï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¿®æ”¹ç»„ä»¶ä»£ç åï¼Œç”¨æˆ·åå’Œå¯†ç <strong>çŠ¶æ€ä¿æŒ</strong>ï¼Œè¿™å°†æå‡åº”ç”¨æœ¬åœ°ç ”å‘ä½“éªŒã€‚</p>
<p><img src="https://gw.alipayobjects.com/zos/antfincdn/B2biHHW6s%24/fast-refresh.gif" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<p>å¼€å‘æ–¹å¼ä¸Šä¸å¹³æ—¶æ²¡æœ‰åŒºåˆ«ï¼Œæ­£å¸¸åœ°ä¿®æ”¹ã€ä¿å­˜ã€é¢„è§ˆï¼Œåªæ˜¯åœ¨æ•ˆæœåé¦ˆä¸Šï¼Œä½“éªŒæ›´åŠ å¥½ã€‚</p>
<h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><p>æœ‰äº›æƒ…å†µä¸‹ï¼Œç»´æŒçŠ¶æ€å¹¶ä¸æ˜¯é¢„æœŸï¼Œæ‰€ä»¥ä¸ºäº†å¯é èµ·è§ï¼ŒFast Refresh é‡åˆ°ä»¥ä¸‹æƒ…å†µä¸€æ¦‚ä¸ä¿ç•™çŠ¶æ€ï¼ˆremountï¼‰ï¼š</p>
<ul>
<li>Class ç±»ç»„ä»¶ä¸€å¾‹é‡åˆ·ï¼ˆremountï¼‰ï¼ŒçŠ¶æ€ä¼šè¢«é‡ç½®ï¼ŒåŒ…æ‹¬é«˜é˜¶ç»„ä»¶è¿”å›çš„ Class ç»„ä»¶</li>
<li>ä¸çº¯ç»„ä»¶æ¨¡å—ï¼Œæ‰€ç¼–è¾‘çš„æ¨¡å—é™¤å¯¼å‡º React ç»„ä»¶å¤–ï¼Œè¿˜å¯¼å‡ºäº†å…¶å®ƒæ¨¡å—</li>
<li>ç‰¹æ®Šçš„ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>// @refresh reset</code> æŒ‡ä»¤ï¼ˆåœ¨æºç æ–‡ä»¶ä¸­ä»»æ„ä½ç½®åŠ ä¸Šè¿™è¡Œæ³¨é‡Šï¼‰å¼ºåˆ¶é‡åˆ·ï¼ˆremountï¼‰ï¼Œæœ€å¤§é™åº¦åœ°ä¿è¯å¯ç”¨æ€§</li>
</ul>
<h3 id="æŠ€å·§"><a href="#æŠ€å·§" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h3><p>æ¨èå†™å‡½æ•°å‘½åç»„ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<p>âœ… Good:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Foo</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Foo</span>;<br></code></pre></td></tr></table></figure>

<p>âŒ Bad:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; &#123;&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><h4 id="TypeError-Cannot-read-property-â€˜forEachâ€™-of-undefined"><a href="#TypeError-Cannot-read-property-â€˜forEachâ€™-of-undefined" class="headerlink" title="TypeError: Cannot read property â€˜forEachâ€™ of undefined"></a>TypeError: Cannot read property â€˜forEachâ€™ of undefined</h4><p>è¯·æ£€æŸ¥æµè§ˆå™¨æ‰©å±• React DevTools çš„ç‰ˆæœ¬ï¼Œæ˜¯å¦å°äº v4ï¼Œè¯·å‡çº§è‡³ v4 ç‰ˆæœ¬å¯è§£å†³ã€‚<a target="_blank" rel="noopener" href="https://github.com/umijs/umi/issues/6432">issue#6432</a></p>
<h2 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><h3 id="é»˜è®¤æ–¹æ¡ˆ"><a href="#é»˜è®¤æ–¹æ¡ˆ" class="headerlink" title="é»˜è®¤æ–¹æ¡ˆ"></a>é»˜è®¤æ–¹æ¡ˆ</h3><p>Umi é»˜è®¤å¯¹æ–°æ‰‹å‹å¥½ï¼Œæ‰€ä»¥é»˜è®¤ä¸åšæŒ‰éœ€åŠ è½½å¤„ç†ï¼Œ<code>umi build</code> åè¾“å‡º <code>index.html</code>ã€<code>umi.js</code> å’Œ <code>umi.css</code> ä¸‰ä¸ªæ–‡ä»¶ã€‚</p>
<h3 id="ä¸è¾“å‡º-html-æ–‡ä»¶"><a href="#ä¸è¾“å‡º-html-æ–‡ä»¶" class="headerlink" title="ä¸è¾“å‡º html æ–‡ä»¶"></a>ä¸è¾“å‡º html æ–‡ä»¶</h3><p>æŸäº›åœºæ™¯ html æ–‡ä»¶äº¤ç»™åç«¯è¾“å‡ºï¼Œå‰ç«¯æ„å»ºå¹¶ä¸éœ€è¦è¾“å‡º html æ–‡ä»¶ï¼Œå¯é…ç½®ç¯å¢ƒå˜é‡ <code>HTML=none</code> å®ç°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ HTML=none umi build<br></code></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²-html-åˆ°éæ ¹ç›®å½•"><a href="#éƒ¨ç½²-html-åˆ°éæ ¹ç›®å½•" class="headerlink" title="éƒ¨ç½² html åˆ°éæ ¹ç›®å½•"></a>éƒ¨ç½² html åˆ°éæ ¹ç›®å½•</h3><p>ç»å¸¸æœ‰åŒå­¦é—®è¿™ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆæˆ‘æœ¬åœ°å¼€å‘æ˜¯å¥½çš„ï¼Œéƒ¨ç½²åå°±æ²¡ååº”äº†ï¼Œè€Œä¸”æ²¡æœ‰æŠ¥é”™ï¼Ÿ</p>
</blockquote>
<p><strong>æ²¡æœ‰æŠ¥é”™ï¼</strong> è¿™æ˜¯åº”ç”¨éƒ¨ç½²åœ¨éæ ¹è·¯å¾„çš„å…¸å‹ç°è±¡ã€‚ä¸ºå•¥ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Ÿå› ä¸ºè·¯ç”±æ²¡æœ‰åŒ¹é…ä¸Šï¼Œæ¯”å¦‚ä½ æŠŠåº”ç”¨éƒ¨ç½²åœ¨ <code>/xxx/</code> ä¸‹ï¼Œç„¶åè®¿é—® <code>/xxx/hello</code>ï¼Œè€Œä»£ç é‡ŒåŒ¹é…çš„æ˜¯ <code>/hello</code>ï¼Œé‚£å°±åŒ¹é…ä¸ä¸Šäº†ï¼Œè€Œåˆæ²¡æœ‰å®šä¹‰ fallback çš„è·¯ç”±ï¼Œæ¯”å¦‚ 404ï¼Œé‚£å°±ä¼šæ˜¾ç¤ºç©ºç™½é¡µã€‚</p>
<p>æ€ä¹ˆè§£å†³ï¼Ÿ</p>
<p>å¯é€šè¿‡é…ç½® <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config#base">base</a> è§£å†³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> default &#123;<br>  base: <span class="hljs-string">&#x27;/path/to/your/app/root&#x27;</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-hash-history"><a href="#ä½¿ç”¨-hash-history" class="headerlink" title="ä½¿ç”¨ hash history"></a>ä½¿ç”¨ hash history</h3><p>å¯é€šè¿‡é…ç½® <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config#history">history</a> ä¸º <code>hash</code> ä¸ºè§£å†³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> default &#123;<br>  <span class="hljs-built_in">history</span>: &#123; <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;hash&#x27;</span> &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="æŒ‰éœ€åŠ è½½-1"><a href="#æŒ‰éœ€åŠ è½½-1" class="headerlink" title="æŒ‰éœ€åŠ è½½"></a>æŒ‰éœ€åŠ è½½</h3><p>è¦å®ç°æŒ‰éœ€åŠ è½½ï¼Œéœ€é…ç½® <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config#dynamicimport">dynamicImport</a>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">dynamicImport</span>: &#123;&#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="é™æ€èµ„æºåœ¨éæ ¹ç›®å½•æˆ–-cdn"><a href="#é™æ€èµ„æºåœ¨éæ ¹ç›®å½•æˆ–-cdn" class="headerlink" title="é™æ€èµ„æºåœ¨éæ ¹ç›®å½•æˆ– cdn"></a>é™æ€èµ„æºåœ¨éæ ¹ç›®å½•æˆ– cdn</h3><p>è¿™æ—¶ï¼Œå°±éœ€è¦é…ç½® <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config#publicpath">publicPath</a>ã€‚è‡³äº publicPath æ˜¯å•¥ï¼Ÿå…·ä½“çœ‹ <a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/output/#output-publicpath">webpack æ–‡æ¡£</a>ï¼ŒæŠŠä»–æŒ‡å‘é™æ€èµ„æºï¼ˆjsã€cssã€å›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰æ‰€åœ¨çš„è·¯å¾„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&quot;http://yourcdn/path/to/static/&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-runtime-çš„-publicPath"><a href="#ä½¿ç”¨-runtime-çš„-publicPath" class="headerlink" title="ä½¿ç”¨ runtime çš„ publicPath"></a>ä½¿ç”¨ runtime çš„ publicPath</h3><p>å¯¹äºéœ€è¦åœ¨ html é‡Œç®¡ç† publicPath çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨ html é‡Œåˆ¤æ–­ç¯å¢ƒåšä¸åŒçš„è¾“å‡ºï¼Œå¯é€šè¿‡é…ç½® <a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/config/#runtimepublicpath">runtimePublicPath</a> ä¸ºè§£å†³ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">runtimePublicPath</span>: <span class="hljs-literal">true</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>ç„¶ååœ¨ html é‡Œè¾“å‡ºï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">publicPath</span> = &lt;%= <span class="hljs-variable constant_">YOUR</span> <span class="hljs-variable constant_">PUBLIC_PATH</span> %&gt;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="é™æ€åŒ–"><a href="#é™æ€åŒ–" class="headerlink" title="é™æ€åŒ–"></a>é™æ€åŒ–</h3><p>åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæ— æ³•åšæœåŠ¡ç«¯çš„ html fallbackï¼Œå³è®©æ¯ä¸ªè·¯ç”±éƒ½è¾“å‡º index.html çš„å†…å®¹ï¼Œé‚£ä¹ˆå°±è¦åšé™æ€åŒ–ã€‚</p>
<p>æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ .umirc.js é‡Œé…ç½®ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">exportStatic</span>: &#123;&#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ umi buildï¼Œä¼šä¸ºæ¯ä¸ªè·¯ç”±è¾“å‡ºä¸€ä¸ª html æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs unknown">./dist<br>â”œâ”€â”€ index.html<br>â”œâ”€â”€ list<br>â”‚   â””â”€â”€ index.html<br>â””â”€â”€ static<br>    â”œâ”€â”€ pages__index.5c0f5f51.async.js<br>    â”œâ”€â”€ pages__list.f940b099.async.js<br>    â”œâ”€â”€ umi.2eaebd79.js<br>    â””â”€â”€ umi.f4cb51da.css<br></code></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šé™æ€åŒ–æš‚ä¸æ”¯æŒæœ‰å˜é‡è·¯ç”±çš„åœºæ™¯ã€‚</p>
</blockquote>
<h3 id="HTML-åç¼€"><a href="#HTML-åç¼€" class="headerlink" title="HTML åç¼€"></a>HTML åç¼€</h3><p>æœ‰äº›é™æ€åŒ–çš„åœºæ™¯é‡Œï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è¯»ç´¢å¼•æ–‡ä»¶çš„ï¼Œæ¯”å¦‚æ”¯ä»˜å®çš„å®¹å™¨ç¯å¢ƒï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”Ÿæˆè¿™ç§ html æ–‡ä»¶ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs unknown">â”œâ”€â”€ index.html<br>â”œâ”€â”€ list<br>â”‚   â””â”€â”€ index.html<br></code></pre></td></tr></table></figure>

<p>è€Œæ˜¯ç”Ÿæˆï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs unknown">â”œâ”€â”€ index.html<br>â””â”€â”€ list.html<br></code></pre></td></tr></table></figure>

<p>é…ç½®æ–¹å¼æ˜¯åœ¨ .umirc.js é‡Œï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">exportStatic</span>: &#123;<br>    <span class="hljs-attr">htmlSuffix</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p>umi build ä¼šç”Ÿæˆï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs unknown">./dist<br>â”œâ”€â”€ index.html<br>â”œâ”€â”€ list.html<br>â””â”€â”€ static<br>    â”œâ”€â”€ pages__index.5c0f5f51.async.js<br>    â”œâ”€â”€ pages__list.f940b099.async.js<br>    â”œâ”€â”€ umi.2924fdb7.js<br>    â””â”€â”€ umi.cfe3ffab.css<br></code></pre></td></tr></table></figure>

<h3 id="é™æ€åŒ–åè¾“å‡ºåˆ°ä»»æ„è·¯å¾„"><a href="#é™æ€åŒ–åè¾“å‡ºåˆ°ä»»æ„è·¯å¾„" class="headerlink" title="é™æ€åŒ–åè¾“å‡ºåˆ°ä»»æ„è·¯å¾„"></a>é™æ€åŒ–åè¾“å‡ºåˆ°ä»»æ„è·¯å¾„</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">exportStatic</span>: &#123;<br>    <span class="hljs-attr">htmlSuffix</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">dynamicRoot</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>
















                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/blog/categories/%E5%89%8D%E7%AB%AF/" class="category-chain-item">å‰ç«¯</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/blog/tags/%E5%89%8D%E7%AB%AF/">#å‰ç«¯</a>
      
        <a href="/blog/tags/umi%E6%A1%86%E6%9E%B6/">#umiæ¡†æ¶</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>umiåŸºç¡€</div>
      <div>https://yoonalis.github.io/blog/2022/11/28/umi/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Azure</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´11æœˆ28æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2022/12/04/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="è®ºæ–‡é€‰é¢˜">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">è®ºæ–‡é€‰é¢˜</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2022/11/20/css/" title="css">
                        <span class="hidden-mobile">css</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/blog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
