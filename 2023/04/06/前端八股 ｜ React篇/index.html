

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.jpg">
  <link rel="icon" href="/blog/img/favicon.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Azure">
  <meta name="keywords" content="">
  
    <meta name="description" content="react的八股">
<meta property="og:type" content="article">
<meta property="og:title" content="前端八股 ｜ react篇">
<meta property="og:url" content="https://yoonalis.github.io/blog/2023/04/06/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%20%EF%BD%9C%20React%E7%AF%87/index.html">
<meta property="og:site_name" content="Azure&#39;s blog">
<meta property="og:description" content="react的八股">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yoonalis.github.io/blog/img/coding.jpg">
<meta property="article:published_time" content="2023-04-06T13:32:15.961Z">
<meta property="article:modified_time" content="2023-04-07T06:37:04.769Z">
<meta property="article:author" content="Azure">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="react">
<meta property="article:tag" content="计算">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yoonalis.github.io/blog/img/coding.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>前端八股 ｜ react篇 - Azure&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yoonalis.github.io","root":"/blog/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/blog/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>Azure</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/album/">
                <i class="iconfont icon-images"></i>
                album
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="前端八股 ｜ react篇"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-06 21:32" pubdate>
          2023年4月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          40k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          335 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">前端八股 ｜ react篇</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="前端八股-｜-React篇"><a href="#前端八股-｜-React篇" class="headerlink" title="前端八股 ｜ React篇"></a>前端八股 ｜ React篇</h1><h2 id="1-react特性"><a href="#1-react特性" class="headerlink" title="1 react特性"></a>1 react特性</h2><p>React 是 Facebook 在2013年开源的用于构建用户界面的 JavaScript 库。</p>
<p><img src="https://img-blog.csdnimg.cn/0ab281e534c644969948a9c50a9e96f5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<h3 id="1、React-独立架构"><a href="#1、React-独立架构" class="headerlink" title="1、React 独立架构"></a>1、React 独立架构</h3><p>React 是 MVC 中薄薄的一层 V，把数据变成 DOM 显示出来，它只关注表现层。</p>
<p>自带的 View 和 Controller 库，在实现应用时，不需要任何其他的库也可以自运行。</p>
<p>React 独立架构的核心是单向数据流，模型图如下：</p>
<p><img src="https://img-blog.csdnimg.cn/ecb8a42803c549e19950820c45817aa7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_18,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<p>其实 React 还有一个很重要的设计思想 &#x3D;&gt; 声明式表达 + 数据驱动DOM</p>
<p>只需要定义数据和 DOM 的对应关系，在数据变化的时候，DOM 会自动变化 &#x3D;&gt; React是个响应式框架</p>
<p>拓展：Flux 架构</p>
<p>React 中有很多地方都用到了 Flux 架构，比如 React Hooks，Redux 也是用的 Flux 架构。</p>
<p>Flux 是由 Facebook 在2014年开源的一款用于构建用户界面的应用程序架构。它不同于 MVC&#x2F;MVVM，是基于 dispatcher 的前端应用架构模式，如果用 MVC 的命名习惯，它应该叫 ADSV（Action Dispatcher Store View）。流程图如下👇👇👇</p>
<p><img src="https://img-blog.csdnimg.cn/c6d83fede1d44c8e886c73e23cf76b21.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<p>Flux 应用是由三部分组成的：</p>
<p>dispatcher（分发事件）</p>
<p>store（保存数据、响应事件、更新数据 ）</p>
<p>view（订阅store中的数据，渲染页面 &#x3D;&gt; React组件）</p>
<p>Flux 没有一个职责明确的 controller，但其实是存在一个 controller-view 的角色，将 store 和 view 进行绑定，controller-view 是整个应用的最顶层，不涉及任何业务逻辑。</p>
<p>从流程图上可以看到数据从 action 到 dispatcher，再到 store，最终到 view，是单向不可逆的，不会像MVC那样有交错的关系。这也是它的一个核心思想 &#x3D;&gt; 数据和逻辑永远单向流动。这个单向数据流是在独立架构上的延伸。</p>
<p>🌸 Flux 思想最著名的实现就是 Redux。</p>
<h3 id="2、函数式编程"><a href="#2、函数式编程" class="headerlink" title="2、函数式编程"></a>2、函数式编程</h3><p>React 在设计时带有函数式编程的基因，因为 React 组件本身就是纯函数。React 的 createElement 方法保证了组件是纯净的，即传入指定 props 得到一定的 Virtual DOM ，整个过程都是可预测的。                                                                ——《深入React技术栈》</p>
<p>React 也是深入贯彻函数式编程的思想，那么什么是函数式编程呢？</p>
<p>函数式编程有三大特性：</p>
<ul>
<li><p>函数是一等公民，函数可以出现在任何地方；</p>
</li>
<li><p>函数式编程关心的是数据映射，不会改变原数据，根据原数据，生成新的数据；</p>
</li>
<li><p>函数式编程是抽象的，方便复用。</p>
</li>
</ul>
<p>React 中函数式编程的体现：</p>
<ul>
<li>在 React 中，强调一个组件不能去修改传入的 prop 值，也是遵循 Immutable 的原则。</li>
<li>在 React 中，组件的 render 函数应该是一个纯函数，来保证组件渲染的结果只和 state&#x2F;props 有关系，遵循  这个公式。</li>
<li>在 Redux 中，更是强调 Immutable 的作用，每个 reducer 不能够修改 state，只能返回一个新的state，这也是函数式编程的要求。</li>
</ul>
<h3 id="3、组件开发模式"><a href="#3、组件开发模式" class="headerlink" title="3、组件开发模式"></a>3、组件开发模式</h3><p>react 的组件，从概念上类似于 JavaScript 函数，组件接受任意入参（即 “props”），并返回用于描述页面展示内容的 React 元素。</p>
<p>react 的组件分为函数组件（Function Components）、类组件（Class Components）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 函数组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Welcome</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 类组件 有生命周期</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Welcome</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>)&#123;<br>    <span class="hljs-variable language_">super</span>(props); <span class="hljs-comment">// 将父类的this对象继承给子类 (MDN参考)</span><br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123; <br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>下面这里例子就可以在页面上渲染 “Hello, Sara”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Welcome</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> element = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Welcome</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Sara&quot;</span> /&gt;</span></span>;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  element,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)<br>);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>🌸  render()</p>
<p>class 组件中唯一必须实现的方法，用于渲染 dom,  render()方法必须返回 reactDOM</p>
<p>注意： 不要在 render 里面 setState，否则会触发死循环导致内存崩溃</p>
</blockquote>
<p>React 生命周期</p>
<p><img src="https://img-blog.csdnimg.cn/2197e246cea94c249ee89337f7a24ac3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<h3 id="4、JSX-语法"><a href="#4、JSX-语法" class="headerlink" title="4、JSX 语法"></a>4、JSX 语法</h3><p>React 为了方便 View 层组件开发模式，承载了构建 HTML 结构化页面的职责，我们可以通过 JSX 处理数据和 DOM 之间的关系，而不需要直接操作 DOM。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 基本使用</span><br><span class="hljs-keyword">const</span> element = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, world!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br><span class="hljs-comment">// 通过引号，给属性值赋值</span><br><span class="hljs-keyword">const</span> element = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">desc</span>=<span class="hljs-string">&quot;标题&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br><span class="hljs-comment">// 通过大括号，在属性值中插入一个 JavaScript 表达式</span><br><span class="hljs-keyword">const</span> element = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/Users/azure/Desktop/面筋/&#123;user.avatarUrl&#125;&quot;</span> /&gt;</span></span>;<br><br><span class="hljs-comment">// JSX + 判断语句</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getGreeting</span>(<span class="hljs-params">user</span>) &#123;<br>  <span class="hljs-keyword">if</span> (user) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;formatName(user)&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, Stranger.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// JSX + 循环表达式</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getGreeting</span>(<span class="hljs-params">user</span>) &#123;<br>  arr.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item,index</span>)=&gt;</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>之所以 JSX 能支持上述写法，是因为在编译阶段 Babel 会把 JSX 转译成 React.createElement() 函数调用。</p>
<p>从这个例子中也可以看出，虽然这些 h1 div img 等标签的名称与 HTML 标签一样，但其实在 JSX 中并没有直接使用 HTML 标签，只是形似的字符串而已（以下称“虚拟元素”）。JSX 操纵虚拟元素来模拟把 HTML 融入 JavaScript 代码中，然后在编译阶段，在转成纯 JavaScript 后由浏览器执行。</p>
<p>总结： JSX 本质</p>
<p>JSX 元素是调用 React.createElement(component, props, …children) 的语法糖。</p>
<p>React 不强制使用 JSX，也可以直接调用 React.createElement</p>
<p>总结： JSX 特点</p>
<ul>
<li>JSX 是一种 JS 扩展的表达式；</li>
<li>JSX 是带有逻辑的标记语法，有别于 HTML 模版；</li>
<li>JSX 支持样式、逻辑表达式和事件。</li>
</ul>
<blockquote>
<ul>
<li>🌸  JSX 防止注入攻击</li>
</ul>
<p>React DOM 在渲染所有输入内容之前，默认会进行转义。所有的内容在渲染之前都被转换成了字符串，它可以确保在你的应用中，永远不会注入那些并非自己明确编写的内容。这样可以有效地防止 XSS（cross-site-scripting, 跨站脚本）攻击。</p>
</blockquote>
<h3 id="5、虚拟DOM（Virtual-DOM）"><a href="#5、虚拟DOM（Virtual-DOM）" class="headerlink" title="5、虚拟DOM（Virtual DOM）"></a>5、虚拟DOM（Virtual DOM）</h3><p>在传统页面的开发模式中，每次需要更新页面时，都要手动操作 DOM 来进行更新，如下图👇👇👇</p>
<p><img src="https://img-blog.csdnimg.cn/3d873539176d4b50ab64cecb896ad229.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<p>然而我们都知道 DOM 操作既复杂（难以维护）又昂贵（性能消耗极大），所以之前会格外注意重排与重绘来保证性能。</p>
<p>React 中，在基建层会统一把我们的编写的代码先编译成 JavaScript 对象树，存在内存里，然后再进一步映射成真实DOM。每次数据更新后，重新计算 Virtual DOM，并和上一次生成的 Virtual DOM 做对比（diff），对发生变化的部分做批量更新，减少低效操作。</p>
<p><img src="https://img-blog.csdnimg.cn/9eaa98ae09564a98a3beec45c33b53b4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiN5aS056eD55qE56CB5Yac,size_20,color_FFFFFF,t_70,g_se,x_16" srcset="/blog/img/loading.gif" lazyload alt="img"></p>
<p>React 也提供了直观的 shouldComponentUpdate 生命周期回调，来减少数据变化后不必要的 Virtual DOM 对比过程，以保证性能。 shouldComponentUpdate(){return false}</p>
<p>使用虚拟DOM最大的好处其实还在于方便和其他平台集成，比如 react-native 是基于 Virtual DOM 渲染出原生控件，因为 React 组件可以映射为对应的原生控件。在输出的时候，是输出 Web DOM，还是 Android 控件，还是 iOS 控件，就由平台本身决定了。因此，react-native 有一个口号——Learn Once，Write Anywhere。</p>
<h3 id="总结：虚拟-DOM-优势"><a href="#总结：虚拟-DOM-优势" class="headerlink" title="总结：虚拟 DOM 优势"></a>总结：虚拟 DOM 优势</h3><p>操作 DOM 前对数据进行对比，只有数据变化的时候才去操作 DOM；</p>
<p>会整合 DOM 操作，可以减少 DOM 操作，提升性能；</p>
<p>便于和其他平台集成，虚拟 DOM 可以映射成 Web DOM，Android 控件，IOS 控件；</p>
<h2 id="2-如何理解单向数据流"><a href="#2-如何理解单向数据流" class="headerlink" title="2 如何理解单向数据流"></a>2 如何理解单向数据流</h2><h3 id="1-你是如何理解单向数据流的？"><a href="#1-你是如何理解单向数据流的？" class="headerlink" title="1.你是如何理解单向数据流的？"></a>1.你是如何理解单向数据流的？</h3><p>组件的状态：状态可以理解为数据，与props类似，但是state是私有的，并且完全受控于当前组件，因此：组件状态指的就是一个组件自己维护的数据。</p>
<p>数据驱动UI：意思很简单，就是：页面所展现的内容，完全是受状态控制的。这也就是mvvm的理念，UI的改变，全部交给框架本身来做，我们只需要管理好数据（状态）就好了。</p>
<p>那么在 React 中，如何对状态进行管理呢？这就是本章节的重点，也是整个 React 学习的重点：组件的状态管理。<br>什么是数据流？</p>
<p>数据流就是：数据在组件之间的传递。</p>
<h3 id="单向数据流是什么意思？"><a href="#单向数据流是什么意思？" class="headerlink" title="单向数据流是什么意思？"></a>单向数据流是什么意思？</h3><p>单向数据流就是：数据在某个节点被改动后，只会影响一个方向上的其他节点。</p>
<h3 id="为什么是自顶向下的？"><a href="#为什么是自顶向下的？" class="headerlink" title="为什么是自顶向下的？"></a>为什么是自顶向下的？</h3><p>就是说：数据只会影响到下一个层级的节点，不会影响上一个层级的节点。用下面的图来说就是：L2数据改变，只会影响到L3，不会影响到L1或者其他的节点。这就是自顶向下的单向数据流。那么我们在react框架中，就可以明确定义单向数据流：规范数据的流向，数据由外层组件向内层组件进行传递和更新。</p>
<p><img src="https://img-blog.csdnimg.cn/6506d09685434f49bf8a2fe8728ed29a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2VpeGluXzM4MjQ1OTQ3,size_12,color_FFFFFF,t_70,g_se,x_16#pic_center" srcset="/blog/img/loading.gif" lazyload alt="在这里插入图片描述"></p>
<p>为什么是单向的？不能是双向的么？</p>
<p>因为：我们设想这样的情景：</p>
<p>父组件的数据通过props传递给子组件，而子组件更新了props，导致父组件和其他关联组件的数据更新，UI渲染也会随着数据而更新。毫无疑问，这是会导致严重的数据紊乱和不可控制的。</p>
<p>不能是双向的。</p>
<p>因此绝大多数框架在这方面做了处理。而 React 在这方面的处理，就是直接规定了 Props 为只读的，而不是可更改的。这也就是我们前面看到的数据更新不能直接通过 this.state 操作，想要更新，就需要通过 React 提供的专门的 this.setState() 方法来做。</p>
<p>单向数据流其实就是一种框架本身对数据流向的限制。</p>
<p>单向数据流有什么作用呢？</p>
<p>保证数据的可控性。</p>
<h3 id="1、React核心思想"><a href="#1、React核心思想" class="headerlink" title="1、React核心思想"></a>1、React核心思想</h3><p>React的核心思想是数据驱动视图，也就是React 的视图会随着数据的变化而变化。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable constant_">UI</span> = <span class="hljs-title function_">render</span>(data)<br><br><span class="hljs-comment">// or </span><br><br><span class="hljs-variable constant_">UI</span> = <span class="hljs-title function_">f</span>(data)<br>复制代码<br></code></pre></td></tr></table></figure>

<h3 id="2、单向数据流"><a href="#2、单向数据流" class="headerlink" title="2、单向数据流"></a>2、单向数据流</h3><p>单向数据流，指的就是当前组件的 state 以 props 的形式流动时，只能流向组件树中比自己层级更低的组件。 比如在父-子组件这种嵌套关系中，只能由父组件传 props 给子组件，而不能反过来。</p>
<p> React 数据流管理方案：</p>
<ul>
<li>使用基于 props 的单向数据流串联父子、兄弟组件；</li>
<li>使用第三方数据流Redux</li>
<li>使用 Context API 维护全局状态</li>
<li>利用“发布-订阅”模式驱动 React 数据在任意组件间流动。</li>
</ul>
<h3 id="3、组件通信方式"><a href="#3、组件通信方式" class="headerlink" title="3、组件通信方式"></a>3、组件通信方式</h3><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ed41bd36cdd4fe7a14e63bdf8b68ee6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="4、props的几种模式"><a href="#4、props的几种模式" class="headerlink" title="4、props的几种模式"></a>4、props的几种模式</h3><h4 id="4-1-props-chidren模式"><a href="#4-1-props-chidren模式" class="headerlink" title="4.1 props chidren模式"></a>4.1 props chidren模式</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Container</span>&gt;<br>    &lt;<span class="hljs-title class_">Children</span>&gt;<br>&lt;/<span class="hljs-title class_">Container</span>&gt;<br>  <br>  <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Container</span>(<span class="hljs-params">props</span>)&#123;<br> 	<span class="hljs-keyword">return</span> props.<span class="hljs-property">children</span><br>&#125;  <br>复制代码<br></code></pre></td></tr></table></figure>

<p>作用：</p>
<ul>
<li>可以根据需要控制 Chidren 是否渲染。</li>
<li>Container 可以用 React.cloneElement 强化 props (混入新的 props )，或者修改 Chidren 的子元素。</li>
</ul>
<h4 id="4-2-render-props模式"><a href="#4-2-render-props模式" class="headerlink" title="4.2 render props模式"></a>4.2 render props模式</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Container</span>&gt;<br>   &#123; <span class="hljs-function">(<span class="hljs-params">ContainerProps</span>)=&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Children</span> &#123;<span class="hljs-attr">...ContainerProps</span>&#125;  /&gt;</span></span> &#125;<br>&lt;/<span class="hljs-title class_">Container</span>&gt;<br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Container</span>(<span class="hljs-params">props</span>) &#123;<br>   <span class="hljs-keyword">const</span> <span class="hljs-title class_">ContainerProps</span> = &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;xiaoming&#x27;</span>,<br>      <span class="hljs-attr">mes</span>:<span class="hljs-string">&#x27;hello&#x27;</span><br>   &#125;<br>   <span class="hljs-keyword">return</span> props.<span class="hljs-title function_">children</span>(<span class="hljs-title class_">ContainerProps</span>)<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>作用：</p>
<ul>
<li>根据需要控制 Chidren 渲染与否。</li>
<li>可以将需要传给 Children 的 props 直接通过函数参数的方式传递给执行函数 children 。</li>
</ul>
<h4 id="4-3-混合模式"><a href="#4-3-混合模式" class="headerlink" title="4.3 混合模式"></a>4.3 混合模式</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Container</span>&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Children</span> /&gt;</span></span><br>    &#123; <span class="hljs-function">(<span class="hljs-params">ContainerProps</span>)=&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Children</span> &#123;<span class="hljs-attr">...ContainerProps</span>&#125; <span class="hljs-attr">name</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">haha</span>&#x27;&#125;  /&gt;</span></span>  &#125;<br>&lt;/<span class="hljs-title class_">Container</span>&gt;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>这种情况需要先遍历 children ，判断 children 元素类型：</p>
<ul>
<li>针对 element 节点，通过 cloneElement 混入 props ；</li>
<li>针对函数，直接传递参数，执行函数。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Children</span> = (<span class="hljs-params">props</span>)=&gt; (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>hello, my name is &#123;  props.name &#125; <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> &#123; props.mes &#125; <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)<br><br><span class="hljs-keyword">function</span>  <span class="hljs-title function_">Container</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ContainerProps</span> = &#123;<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;xiaoming&#x27;</span>,<br>        <span class="hljs-attr">mes</span>:<span class="hljs-string">&#x27;hello&#x27;</span><br>    &#125;<br>     <span class="hljs-keyword">return</span> props.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title class_">React</span>.<span class="hljs-title function_">isValidElement</span>(item))&#123; <span class="hljs-comment">// 判断是 react elment  混入 props</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">cloneElement</span>(item,&#123; ...<span class="hljs-title class_">ContainerProps</span> &#125;,item.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>)<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">&#x27;function&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_">item</span>(<span class="hljs-title class_">ContainerProps</span>)<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>     &#125;)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Index</span> = (<span class="hljs-params"></span>)=&gt;&#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Container</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Children</span> /&gt;</span></span><br><span class="language-xml">        &#123; (ContainerProps)=&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Children</span> &#123;<span class="hljs-attr">...ContainerProps</span>&#125; <span class="hljs-attr">name</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">haha</span>&#x27;&#125;  /&gt;</span>  &#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Container</span>&gt;</span></span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h3 id="5、Redux"><a href="#5、Redux" class="headerlink" title="5、Redux"></a>5、Redux</h3><p>在 Redux 的整个工作过程中，数据流是严格单向的。</p>
<p>如果你想对数据进行修改，只有一种途径：派发 action。action 会被 reducer 读取，进而根据 action 内容的不同对数据进行修改、生成新的 state（状态），这个新的 state 会更新到 store 对象里，进而驱动视图层面做出对应的改变。</p>
<p>对于组件来说，任何组件都可以通过约定的方式从 store 读取到全局的状态，任何组件也都可以通过合理地派发 action 来修改全局的状态。Redux 通过提供一个统一的状态容器，使得数据能够自由而有序地在任意组件之间穿梭。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6821d9516f0d4b0e993ff9951f50d23d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<ol>
<li>使用 createStore 来完成 store 对象的创建</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// 引入 redux</span><br><span class="hljs-keyword">import</span> &#123; createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span><br><span class="hljs-comment">// 创建 store</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(<br>    reducer,<br>    initial_state,<br>    <span class="hljs-title function_">applyMiddleware</span>(middleware1, middleware2, ...)<br>);<br>复制代码<br></code></pre></td></tr></table></figure>

<ol>
<li>reducer 的作用是将新的 state 返回给 store</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">state, action</span>) =&gt; &#123;<br>    <span class="hljs-comment">// 此处是各种样的 state处理逻辑</span><br>    <span class="hljs-keyword">return</span> new_state<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<ol>
<li>action 的作用是通知 reducer “让改变发生”</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> action = &#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;ADD_ITEM&quot;</span>,<br>  <span class="hljs-attr">payload</span>: <span class="hljs-string">&#x27;&lt;li&gt;text&lt;/li&gt;&#x27;</span><br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<ol>
<li>派发 action，靠的是 dispatch</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span><br><span class="hljs-comment">// 创建 reducer</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">state, action</span>) =&gt; &#123;<br>    <span class="hljs-comment">// 此处是各种样的 state处理逻辑</span><br>    <span class="hljs-keyword">return</span> new_state<br>&#125;<br><span class="hljs-comment">// 基于 reducer 创建 state</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(reducer)<br><span class="hljs-comment">// 创建一个 action，这个 action 用 “ADD_ITEM” 来标识 </span><br><span class="hljs-keyword">const</span> action = &#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;ADD_ITEM&quot;</span>,<br>  <span class="hljs-attr">payload</span>: <span class="hljs-string">&#x27;&lt;li&gt;text&lt;/li&gt;&#x27;</span><br>&#125;<br><br><span class="hljs-comment">// 订阅</span><br>store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-title function_">getState</span>()))<br><br><span class="hljs-comment">// 使用 dispatch 派发 action，action 会进入到 reducer 里触发对应的更新</span><br>store.<span class="hljs-title function_">dispatch</span>(action)<br>复制代码<br></code></pre></td></tr></table></figure>

<h3 id="6-Context"><a href="#6-Context" class="headerlink" title="6. Context"></a>6. Context</h3><p>Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3da17f70ab6b43319b638ccd8a1baae7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<p>基本用法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-string">&quot;light&quot;</span>) <span class="hljs-comment">//</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeProvider</span> = <span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>  <span class="hljs-comment">//提供者</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeConsumer</span> = <span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Consumer</span> <span class="hljs-comment">// 订阅消费者</span><br>复制代码<br></code></pre></td></tr></table></figure>

<p>Provider：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeProvider</span> = <span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>  <span class="hljs-comment">//提供者</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ConsumerComponent</span> form <span class="hljs-string">&#x27;./ConsumerComponent&#x27;</span><br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProviderComponent</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">const</span> [ theme , setTheme ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">theme</span>: <span class="hljs-string">&quot;light&quot;</span> &#125;)<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;</span> <span class="hljs-attr">theme</span> &#125; &gt;</span> </span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">ConsumerComponent</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ProviderComponent</span><br>复制代码<br></code></pre></td></tr></table></figure>

<p>provider 作用有两个：</p>
<ul>
<li>value 属性传递 context，供给 Consumer 使用。</li>
<li>value 属性改变，ThemeProvider 会让消费 Provider value 的组件重新渲染。</li>
</ul>
<p>Consumer：</p>
<p>类组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 类组件 - contextType 方式</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span>&#123;<br>   <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>)&#123;<br>       <span class="hljs-keyword">const</span> &#123; theme &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span><br>       <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> <span class="hljs-attr">theme</span> &#125; &#125;&gt;</span>消费者<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> <br>   &#125;<br>&#125;<br><br><span class="hljs-title class_">ConsumerComponent</span>.<span class="hljs-property">contextType</span> = <span class="hljs-title class_">ThemeContext</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ConsumerComponent</span><br>复制代码<br></code></pre></td></tr></table></figure>

<p>函数组件：</p>
<p>（1）使用useContext：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ConsumerComponent</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">const</span>  contextValue = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>)<br>    <span class="hljs-keyword">const</span> &#123; theme &#125; = contextValue<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> <span class="hljs-attr">theme</span> &#125; &#125; &gt;</span>消费者<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> <br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>（2）使用订阅者：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeConsumer</span> = <span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Consumer</span> <span class="hljs-comment">// 订阅消费者</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">ConsumerComponent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeConsumer</span>&gt;</span></span><br><span class="language-xml">       &#123; (contextValue)=&gt; // todo &#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeConsumer</span>&gt;</span></span><br>	) <br>&#125;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<h3 id="7、发布订阅"><a href="#7、发布订阅" class="headerlink" title="7、发布订阅"></a>7、发布订阅</h3><p>事件的监听（订阅）和事件的触发（发布）</p>
<ul>
<li>on()：负责注册事件的监听器，指定事件触发时的回调函数。</li>
<li>emit()：负责触发事件，可以通过传参使其在触发的时候携带数据 。</li>
</ul>
<h4 id="7-1-映射"><a href="#7-1-映射" class="headerlink" title="7.1 映射"></a>7.1 映射</h4><p>事件和监听函数的对应关系“映射”，处理“映射”我们大部分情况下都是用对象来做的。所以说在全局我们需要设置一个对象，来存储事件和监听函数之间的关系：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-comment">// eventMap 用来存储事件和监听函数之间的关系</span><br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span> = &#123;&#125;;<br> &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h4 id="7-2-订阅"><a href="#7-2-订阅" class="headerlink" title="7.2 订阅"></a>7.2 订阅</h4><p>把事件和对应的监听函数写入到 eventMap 里面去：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// type 这里就代表事件的名称</span><br><span class="hljs-title function_">on</span>(<span class="hljs-params">type, handler</span>) &#123;<br>  <span class="hljs-comment">// hanlder 必须是一个函数，如果不是直接报错</span><br>  <span class="hljs-keyword">if</span>(!(handler <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Function</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;需要传一个函数&quot;</span>)<br>  &#125;<br>  <span class="hljs-comment">// 判断 type 事件对应的队列是否存在</span><br>  <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>   <span class="hljs-comment">// 若不存在，新建该队列</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type] = []<br>  &#125;<br>  <span class="hljs-comment">// 若存在，直接往队列里推入 handler</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">push</span>(handler)<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h4 id="7-3-发布"><a href="#7-3-发布" class="headerlink" title="7.3 发布"></a>7.3 发布</h4><p>发布操作就是一个“读”操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 别忘了我们前面说过触发时是可以携带数据的，params 就是数据的载体</span><br><span class="hljs-title function_">emit</span>(<span class="hljs-params">type, params</span>) &#123;<br>  <span class="hljs-comment">// 假设该事件是有订阅的（对应的事件队列存在）</span><br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>    <span class="hljs-comment">// 将事件队列里的 handler 依次执行出队</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">handler, index</span>)=&gt;</span> &#123;<br>      <span class="hljs-comment">// 注意别忘了读取 params</span><br>      <span class="hljs-title function_">handler</span>(params)<br>    &#125;)<br>  &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h4 id="7-4-关闭"><a href="#7-4-关闭" class="headerlink" title="7.4 关闭"></a>7.4 关闭</h4><p>关闭就是一个出队列的操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">off</span>(<span class="hljs-params">type, handler</span>) &#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">indexOf</span>(handler)&gt;&gt;&gt;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>  &#125;<br>&#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h4 id="7-5-测试"><a href="#7-5-测试" class="headerlink" title="7.5 测试"></a>7.5 测试</h4><p>完整代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">myEventEmitter</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span> = &#123;&#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">on</span>(<span class="hljs-params">type, handler</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!handler <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Function</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;请传一个函数&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type] = []<br>        &#125;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">push</span>(handler)<br>    &#125;<br><br>    <span class="hljs-title function_">emit</span>(<span class="hljs-params">type, params</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">handler</span>) =&gt;</span> &#123;<br>                <span class="hljs-title function_">handler</span>(params);<br>            &#125;)<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-title function_">off</span>(<span class="hljs-params">type, handler</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-comment">// 位运算 负数返回无限大的数，否则返回本身</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">indexOf</span>(handler) &gt;&gt;&gt; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> myEvent = <span class="hljs-keyword">new</span> <span class="hljs-title function_">myEventEmitter</span>();<br><span class="hljs-comment">// 编写一个简单的 handler</span><br><span class="hljs-keyword">const</span> testHandler = <span class="hljs-keyword">function</span> (<span class="hljs-params">params</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`test事件被触发了，testHandler 接收到的入参是<span class="hljs-subst">$&#123;params&#125;</span>`</span>);<br>&#125;;<br><span class="hljs-comment">// 监听 test 事件</span><br>myEvent.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;test&quot;</span>, testHandler);<br><span class="hljs-comment">// 在触发 test 事件的同时，传入希望 testHandler 感知的参数</span><br>myEvent.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br><br><span class="hljs-comment">// myEvent.off(&quot;test&quot;, testHandler);</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`object`</span>, myEvent.<span class="hljs-property">eventMap</span>)<br>复制代码<br></code></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be2c22a6a7c74fbc8e4560dabf0c0e0f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="7-6-在React中应用"><a href="#7-6-在React中应用" class="headerlink" title="7.6 在React中应用"></a>7.6 在React中应用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// index.jsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> A <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./A&#x27;</span><br><span class="hljs-keyword">import</span> B <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./B&#x27;</span><br><span class="hljs-keyword">import</span> event <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./event.js&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">React</span>.<span class="hljs-property">$myEvent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">event</span>()<br>        <span class="hljs-keyword">return</span> (<br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">A</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">A</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">B</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">B</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>        )<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> index<br>复制代码<br><span class="hljs-comment">// event.js</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">myEventEmitter</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span> = &#123;&#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">on</span>(<span class="hljs-params">type, handler</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!handler <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Function</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;请传一个函数&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type] = []<br>        &#125;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">push</span>(handler)<br>    &#125;<br><br>    <span class="hljs-title function_">emit</span>(<span class="hljs-params">type, params</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">handler</span>) =&gt;</span> &#123;<br>                <span class="hljs-title function_">handler</span>(params);<br>            &#125;)<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-title function_">off</span>(<span class="hljs-params">type, handler</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type]) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventMap</span>[type].<span class="hljs-title function_">indexOf</span>(handler) &gt;&gt;&gt; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> myEventEmitter<br>复制代码<br><span class="hljs-comment">// A</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123;<br>    <span class="hljs-attr">newParams</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  &#125;;<br>  handler = <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">newParams</span>: params,<br>    &#125;);<br>  &#125;;<br>  bindHandler = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">React</span>.<span class="hljs-property">$myEvent</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;someEvent&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handler</span>);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.bindHandler&#125;</span>&gt;</span>点我监听A的动作<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>A传入的内容是[&#123;this.state.newParams&#125;]<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> A;<br>复制代码<br><span class="hljs-comment">// B</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123;<br>    <span class="hljs-attr">infoToB</span>: <span class="hljs-string">&quot;哈哈哈哈我来自A&quot;</span>,<br>  &#125;;<br>  reportToB = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">React</span>.<span class="hljs-property">$myEvent</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;someEvent&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">infoToB</span>);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.reportToB&#125;</span>&gt;</span>点我把state传递给B<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> B;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c785d82be59c40e99c7f73b22decfb84~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="3-单向数据流和双向数据流的对比"><a href="#3-单向数据流和双向数据流的对比" class="headerlink" title="3 单向数据流和双向数据流的对比"></a>3 单向数据流和双向数据流的对比</h2><h3 id="一、单向数据流"><a href="#一、单向数据流" class="headerlink" title="一、单向数据流"></a>一、单向数据流</h3><h4 id="1-什么是单向数据流？"><a href="#1-什么是单向数据流？" class="headerlink" title="1. 什么是单向数据流？"></a>1. 什么是单向数据流？</h4><p>单向数据流（Unidirectional data flow）方式使用一个上传数据流和一个下传数据流进行双向数据通信，两个数据流之间相互独立。单向数据流指只能从一个方向来修改状态。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edc419b4e49842a49cef1b1681a34854~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="2-Vue-中的单向数据流"><a href="#2-Vue-中的单向数据流" class="headerlink" title="2. Vue 中的单向数据流"></a>2. Vue 中的单向数据流</h4><p>对于 Vue 来说，组件之间的数据传递具有单向数据流这样的特性。</p>
<ol>
<li>父组件总是通过 props 向子组件传递数据；</li>
<li>所有的 prop 都使得其父子 prop 之间形成了一个单向下行绑定；</li>
<li>父级 prop 的更新会向下流动到子组件中，但是反过来则不行；</li>
<li>这样会防止从子组件意外改变父级组件的状态，从而导致你的应用的数据流向难以理解；</li>
<li>每次父级组件发生更新时，子组件中所有的 prop 都将会刷新为最新的值；</li>
<li>这意味着不应该在一个子组件内部改变 prop。如果这样做，Vue 会在浏览器的控制台中发出警告。</li>
</ol>
<h4 id="3-单向数据流-优点"><a href="#3-单向数据流-优点" class="headerlink" title="3. 单向数据流 - 优点"></a>3. 单向数据流 - 优点</h4><ol>
<li>所有状态的改变可记录、可跟踪，源头易追溯；</li>
<li>所有的数据，具有唯一出口和入口，使得数据操作更直观更容易理解，可维护性强；</li>
<li>当数据变化时，页面会自动变化</li>
<li>当你需要修改状态，完全重新开始走一个修改的流程。这限制了状态修改的方式，让状态变得可预测，容易调试。</li>
</ol>
<h4 id="4-单向数据流-缺点"><a href="#4-单向数据流-缺点" class="headerlink" title="4. 单向数据流 - 缺点"></a>4. 单向数据流 - 缺点</h4><ol>
<li>页面渲染完成后，有新数据不能自动更新，需要手动整合新数据和模板重新渲染</li>
<li>代码量上升，数据流转过程变长，代码重复性变大</li>
<li>由于对应用状态独立管理的严格要求(单一的全局 store，如：Vuex)，在处理局部状态较多的场景时(如用户输入交互较多的“富表单型”应用)，会显得啰嗦及繁琐。</li>
</ol>
<h3 id="二、双向数据流"><a href="#二、双向数据流" class="headerlink" title="二、双向数据流"></a>二、双向数据流</h3><h4 id="1-什么是双向数据流？"><a href="#1-什么是双向数据流？" class="headerlink" title="1. 什么是双向数据流？"></a>1. 什么是双向数据流？</h4><p>在双向数据流中，Model（可以理解为状态的集合） 中可以修改自己或其他Model的状态， 用户的操作（如在输入框中输入内容）也可以修改状态。（双向数据流也可以叫双向数据绑定）</p>
<hr>
<p>当我们在前端开发中采用 <code>MV*</code> 的模式时，<code>M - model</code>，指的是模型，也就是数据，<code>V - view</code>，指的是视图，也就是页面展现的部分。</p>
<hr>
<p>将从服务器获取的数据进行“渲染”，展现到视图上。每当数据有变更时，我们会再次进行渲染，从而更新视图，使得视图与数据保持一致</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6022bab6df5a45b695c431e0cdd0ffea~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<hr>
<p>页面也会通过用户的交互，产生状态、数据的变化，这个时候，我们则编写代码，将视图对数据的更新同步到数据</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cdbd1d1278149fd94ad5de91d4ecae2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="image.png"></p>
<hr>
<h4 id="2-双向数据流-优点"><a href="#2-双向数据流-优点" class="headerlink" title="2. 双向数据流 - 优点"></a>2. 双向数据流 - 优点</h4><ol>
<li>数据模型变化与更新，会自动同步到页面上，用户在页面的数据操作，也会自动同步到数据模型</li>
<li>无需进行和单向数据绑定的那些相关操作；</li>
<li>在表单交互较多的场景下，会简化大量业务无关的代码。</li>
</ol>
<h4 id="3-双向数据流-缺点"><a href="#3-双向数据流-缺点" class="headerlink" title="3. 双向数据流 - 缺点"></a>3. 双向数据流 - 缺点</h4><ol>
<li>无法追踪局部状态的变化；</li>
<li>“暗箱操作”，增加了出错时 debug 的难度；</li>
<li>由于组件数据变化来源入口变得可能不止一个，数据流转方向易紊乱。</li>
<li>改变一个状态有可能会触发一连串的状态的变化，最后很难预测最终的状态是什么样的。使得代码变得很难调试</li>
</ol>
<h2 id="4-异步的-setState"><a href="#4-异步的-setState" class="headerlink" title="4 异步的 setState"></a>4 异步的 setState</h2><p><strong>setState 是异步还是同步的？</strong></p>
<p>这是一个面试中经常会被问到的经典面试题，在开始讲解异步特性之前，我们需要先明确，从 API 层面上说，它就是普通的调用执行的函数 ，自然是同步 API 。因此，这里所说的同步和异步，指的是 API 调用后，state 的改变或者更新 DOM 的时机，是同步还是异步的。</p>
<p>我们先来看一段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">States</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  state = &#123;<br>    <span class="hljs-attr">name</span>:<span class="hljs-string">&quot;lisi&quot;</span>,<br>    <span class="hljs-attr">age</span>:<span class="hljs-number">18</span><br>  &#125;<br><br>  fun= <span class="hljs-function">()=&gt;</span>&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiling&#x27;</span><br>    &#125;)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">name</span>)<br>  &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>State 组件<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;this.state.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span>=&gt;</span>&#123;this.fun()&#125;&#125;&gt;点我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    )<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">States</span><br>复制代码<br></code></pre></td></tr></table></figure>

<p>代码实现的的功能非常简单，就是在点击按钮后，修改 state 中的 name 属性值，事件处理函数中，是在调用 setState 方法之后，又将 state 的值打印到了控制台，运行代码你会发现， Dom 中的值发生了改变，但是控制台却是之前的结果值，如果你对异步的运行规则比较熟悉，你一定不会感到奇怪，很显然，<code>this.setState()</code> 是异步执行的，调用之后，后面的代码就紧跟着执行了，因此，控制台打印的结果肯定是修改之前。</p>
<p>因此，我们可以确定，<code>this.setState() </code><strong>确实是异步调用执行的代码</strong>。</p>
<p>注意，此时，你可以将 <code>this.setState()</code> 当作普通的异步执行代码 （再次强调 JSX 就是 JS）。</p>
<p>那么，如果我想调整代码获取异步执行结果，应该怎么做呢？既然可以看作为普通的异步代码，想想也知道，其实 <code>this.setState()</code> 方法还提供了第二个参数，我们可以传入一个回调函数，这个函数就是异步结束后执行的回调函数，具体代码修改如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">  <span class="hljs-function"><span class="hljs-keyword">fun</span>= <span class="hljs-title">async</span> <span class="hljs-params">()</span></span>=&gt;&#123;<br>    await <span class="hljs-keyword">this</span>.setState(&#123;<br>      name:<span class="hljs-string">&#x27;xiling&#x27;</span><br>    &#125;,()=&gt;&#123;<br>      console.log(<span class="hljs-keyword">this</span>.state.name)<br>    &#125;)<br>  &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>回调函数处理异步结果本来就是传统的异步编码方式，但是，我们也知道，异步中的回调函数有一个最大的问题就是 “<strong>回调地狱</strong>”，那么既然是异步，我们是不是就可以封装一个 Promise 了呢？</p>
<p>当然可以，但是，封装一个 Promise 就显得有些复杂，最简单的方式就是借助 ES 2017 中异步调用函数 <code>async / await</code> 来实现，我们直接修改事件处理函数即可，具体语法规则如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"> <span class="hljs-function"><span class="hljs-keyword">fun</span>= <span class="hljs-title">async</span> <span class="hljs-params">()</span></span>=&gt;&#123;<br>    await <span class="hljs-keyword">this</span>.setState(&#123;<br>      name:<span class="hljs-string">&#x27;xiling&#x27;</span><br>    &#125;)<br>    console.log(<span class="hljs-keyword">this</span>.state.name)<br>  &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<h3 id="setState-的执行逻辑"><a href="#setState-的执行逻辑" class="headerlink" title="setState 的执行逻辑"></a>setState 的执行逻辑</h3><p>在使用 <code>this.setState()</code> 进行状态更改时，需要进行逻辑处理应该怎么做呢？其实 <code>this.setState()</code> 的第一个参数是可以接收一个函数处理的，需要注意的是，函数的运行必须返回一个 state 对象，具体代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">  <span class="hljs-function"><span class="hljs-keyword">fun</span> = <span class="hljs-params">()</span></span>=&gt;&#123;<br>    <span class="hljs-keyword">this</span>.setState((state)=&gt;&#123;<br>      <span class="hljs-comment">// 函数逻辑代码 ……</span><br>      let returnData<br>      returnData = state.age+<span class="hljs-number">1</span><br>      <span class="hljs-comment">// 最终返回一个 state 对象</span><br>      <span class="hljs-keyword">return</span> &#123;<br>        age:returnData<br>      &#125;<br>    &#125;)<br>  &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>也就是说 <code>this.setState()</code> 既可以接收对象参数，也可以接收一个处理函数，那么，这两者又有什么区别呢？</p>
<p>在时间处理函数中，我们分别使用两次 <code>this.setState()</code> 对 state 进行修改操作。</p>
<p>两次函数执行操作：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">  <span class="hljs-function"><span class="hljs-keyword">fun</span> = <span class="hljs-params">()</span></span>=&gt;&#123;<br>    <span class="hljs-keyword">this</span>.setState((state)=&gt;&#123;<br>      <span class="hljs-keyword">return</span> &#123;<br>        age:state.age+<span class="hljs-number">2</span><br>      &#125;<br>    &#125;)<br><br>    <span class="hljs-keyword">this</span>.setState((state)=&gt;&#123;<br>      <span class="hljs-keyword">return</span> &#123;<br>        age:state.age+<span class="hljs-number">3</span><br>      &#125;<br>    &#125;)<br>  &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>运行代码可以发现，两次 <code>this.setState()</code> 中的函数都得到了执行，修改了 state 的值，我们在将同样的代码逻辑，使用对象数据的方式进行修改操作：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">  <span class="hljs-function"><span class="hljs-keyword">fun</span> = <span class="hljs-params">()</span></span>=&gt;&#123;<br>    <span class="hljs-keyword">this</span>.setState(&#123;<br>      age:<span class="hljs-keyword">this</span>.state.age +<span class="hljs-number">2</span><br>    &#125;)<br>    <span class="hljs-keyword">this</span>.setState(&#123;<br>      age:<span class="hljs-keyword">this</span>.state.age +<span class="hljs-number">3</span><br>    &#125;)<br>  &#125;<br>复制代码<br></code></pre></td></tr></table></figure>

<p>结果显示，只有最后一次 <code>this.setState()</code> 得到了执行。</p>
<p>没错，<code>this.setState()</code> 如果是函数，那么函数会依次从上往下执行，而如果是一个对象， React 会将多次 <code>this.setState()</code> 的调用合并为一次执行，如果修改的了相同的值，则会将前面的修改替换成最后一次的修改数据。</p>
<p>这一点在项目编码中一定要牢记，避免出现意外的逻辑 Bug 。</p>
<p>当然，你可能也发现了一个问题，我们说了那么多关于组件状态的问题，各种实验编码都是在 class 类组件中完成的，那函数组件中是不是和类组件一样呢？</p>
<h2 id="5-避免重复渲染的方法"><a href="#5-避免重复渲染的方法" class="headerlink" title="5 避免重复渲染的方法"></a>5 避免重复渲染的方法</h2><p>使用React已经三年了，在这三年里面也沉积了不少关于React代码优化的最佳实践，今天先写一部分出来和大家分享分享。后续看文章是否受欢迎再觉得是否分享后面的。</p>
<p>这篇文章的每一个最佳实践我都会提供两个例子，一好一坏作为对比，和提供<code>.gif</code> 图片预览。</p>
<p>本片文章主要对以下这三种情况进行优化：</p>
<ul>
<li>父组件更新导致子组件渲染</li>
<li>Props的错误写法导致组件渲染</li>
<li>Context的更新导致组件渲染</li>
</ul>
<p>看完文章如果你觉得对你有了帮助，请帮忙点个赞，你的点赞是我创作的最大动力。<strong>评论点赞可以获得源码！！</strong></p>
<h3 id="父组件更新导致子组件渲染"><a href="#父组件更新导致子组件渲染" class="headerlink" title="父组件更新导致子组件渲染"></a>父组件更新导致子组件渲染</h3><h3 id="Class-示例"><a href="#Class-示例" class="headerlink" title="Class 示例"></a>Class 示例</h3><h4 id="❎-错误示例预览"><a href="#❎-错误示例预览" class="headerlink" title="❎ 错误示例预览"></a>❎ 错误示例预览</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a35acb5e75a64b1ca1ee523e1501d063~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="1.classBad.gif"></p>
<h4 id="❎-错误示例"><a href="#❎-错误示例" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件重新渲染了！！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Parent</span>, <span class="hljs-title class_">Son</span> &#125;;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中， 父组件中的state 发生变化导致了子组件的重新渲染，这样写的代码是一个很正常的写法，但是认真说起来，还是会造成性能上的浪费，毕竟子组件重新渲染了！接下来我们看看怎样解决这个问题！</p>
<p><strong>说明： 本示例并不是说要杜绝写这样的代码，其实优化也是要看场景的！！</strong></p>
<h4 id="✅-正确示例-1"><a href="#✅-正确示例-1" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, <span class="hljs-title class_">PureComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件重新渲染了！！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个例子中我们主要是借用了 <strong>PureComponent</strong> 继承这个类，React会自动帮我们执行 <strong>shouldComponentUpdate</strong> 对 Props 进行浅比较优化更新。</p>
<p><strong>说明： 其实认真的讲，在React中组件会被 React.createElement(Son) 执行，所得到的组件的Props引用每次都是新的，因此会引发重新渲染！</strong></p>
<h4 id="✅-正确示例-2"><a href="#✅-正确示例-2" class="headerlink" title="✅ 正确示例 2"></a>✅ 正确示例 2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">const</span> &#123; children &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Parent</span>&gt;</span></span><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例的优化中，我们将有状态组件和无状态组件进行分离，使用 <strong>children</strong> 将无状态组件传入。这样会避免无意义的重复渲染！ 那为什么这样写会避免重新渲染呢？ 因为直接在状态组件中使用<strong>children</strong>直接渲染子组件可以避免在状态组件中React使用<strong>React.createElement(Son)</strong> 渲染子组件！！这样也可以做到优化！</p>
<h4 id="✅-正确示例-3"><a href="#✅-正确示例-3" class="headerlink" title="✅ 正确示例 3"></a>✅ 正确示例 3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, memo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Son</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Bad&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoSon</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Son</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Son</span>&gt;</span></span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例3<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">MemoSon</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中其实实现优化的思想和示例1 所提到的思想类似， 我们借用了<strong>memo</strong> 函数，这个函数其实是为<strong>Function组件</strong> 准备的优化手段。我们在这里也是厚着脸皮强行使用一下！！，避免重新渲染的思想其实也是对比Props的引用。决定是否渲染！！</p>
<h4 id="✅-正确示例-4"><a href="#✅-正确示例-4" class="headerlink" title="✅ 正确示例 4"></a>✅ 正确示例 4</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, useState, <span class="hljs-title class_">Fragment</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Son</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Bad&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">ClickCount</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例4<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ClickCount</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>本示例中，我们的优化手段主要是将状态组件提出去成一个组件，这样状态的改变就和子组件分离开了。也可以避免子组件的重新渲染！！</p>
<p><strong>说明： 这个优化手段认真讲还是用到挺少的，看情况使用吧！！</strong></p>
<h3 id="Hooks-示例"><a href="#Hooks-示例" class="headerlink" title="Hooks 示例"></a>Hooks 示例</h3><h4 id="错误示例预览"><a href="#错误示例预览" class="headerlink" title="错误示例预览"></a>错误示例预览</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0970a11548c54714a7df5718eac2cce6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="1.HooksBad.gif"></p>
<h4 id="❎-错误示例-1"><a href="#❎-错误示例-1" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Son</span>, <span class="hljs-title class_">Parent</span> &#125;;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>对于Hooks来说上面的写法也是非常正常的写法，但是与Class组件相比，<strong>Function组件</strong> 的特性是每一次的组件重新渲染，都会重新执行一次函数。而对于Class组件来说，只会执行一遍 <strong>new Class</strong> ,其实仔细想想还是挺可怕的。对函数组价来说，每次的执行都意味着新的上下文，新的变量，新的作用域。因此我们要更加注重函数组件的性能优化。</p>
<h4 id="✅-正确示例-1-1"><a href="#✅-正确示例-1-1" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params">&#123; children &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">&lt;/Parent</span><br><span class="language-xml"></span><br><span class="language-xml">复制代码</span><br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中，我们使用了<strong>children</strong> 直接渲染子组件，原理其实在上面Class组件示例中已经讲过了，这样的优化也能避免无意义的渲染。</p>
<p><strong>说明： 认真的讲，结合函数组件的特性这个优化手段其实是治标不治本的！</strong></p>
<h4 id="✅-正确示例-2-1"><a href="#✅-正确示例-2-1" class="headerlink" title="✅ 正确示例 2"></a>✅ 正确示例 2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, useMemo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Son</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Bad&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;useMemo(</span><br><span class="language-xml">        () =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> /&gt;</span></span><br><span class="language-xml">        ),</span><br><span class="language-xml">        []</span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中我们使用了<strong>useMemo</strong> 这个优化Hook，我们将 Son 组件进行缓存，只有当依赖改变，我们再去重新执行函数完成重新渲染，其他时机保证<strong>memoized</strong>相同，这样有助于避免在每次渲染时都进行高开销的计算。也避免了 每次在子组件中 都要重新声明变量，函数，作用域等。</p>
<p><strong>说明：我觉得这个优化手段绝对称得上神来之笔，因为 useMemo 保存了组件的引用，没有重新执行函数组件，因此避免了组件内的变量，函数声明，和作用域的声明。从而优化了性能。 Nice！！</strong></p>
<h4 id="✅-正确示例-3-1"><a href="#✅-正确示例-3-1" class="headerlink" title="✅ 正确示例 3"></a>✅ 正确示例 3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, memo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Son</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Bad&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">SonMemo</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Son</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例3<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SonMemo</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>本示例中我们运用了<strong>memo</strong>这个api, 主要是对比props引用是否改变，从而避免子组件的重新渲染！</p>
<h3 id="Props的错误写法导致组件渲染"><a href="#Props的错误写法导致组件渲染" class="headerlink" title="Props的错误写法导致组件渲染"></a>Props的错误写法导致组件渲染</h3><h3 id="Class-示例-1"><a href="#Class-示例-1" class="headerlink" title="Class 示例"></a>Class 示例</h3><h4 id="❎-错误示例预览-1"><a href="#❎-错误示例预览-1" class="headerlink" title="❎ 错误示例预览"></a>❎ 错误示例预览</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d31e1ec190a42a8bb3b81f5b4df9da9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="2.ClassBad.gif"></p>
<h4 id="❎-错误示例-2"><a href="#❎-错误示例-2" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, <span class="hljs-title class_">PureComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">componentDetails</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">name:</span> &quot;<span class="hljs-attr">子组件</span>&quot; &#125;&#125; <span class="hljs-attr">anyMethod</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;&#125;&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; componentDetails, anyMethod &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; render -&gt; anyMethod&quot;</span>, anyMethod);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; render -&gt; componentDetails&quot;</span>, componentDetails);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>&#123;componentDetails?.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Parent</span>, <span class="hljs-title class_">Son</span> &#125;;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>这个示例中Props的传递直接是错误的写法，为什么呢？因为组件的渲染主要是通过监听Props和State的变化进行渲染的，那在这个示例传的props每次都是一个新的对象，<strong>因为引用的不同，每次的父组件的渲染都会导致子组件的渲染。</strong> 因此这种写法造成的重新渲染实数不该！！</p>
<p>那我们应该怎么写呢？</p>
<h4 id="✅-正确示例-1-2"><a href="#✅-正确示例-1-2" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, <span class="hljs-title class_">PureComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">componentDetails</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;子组件&quot;</span> &#125;,<br>    &#125;;<br>  &#125;<br>  handleClick = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br>  anyMethod = <span class="hljs-function">() =&gt;</span> &#123;&#125;;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; count, componentDetails &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例 1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">componentDetails</span>=<span class="hljs-string">&#123;componentDetails&#125;</span> <span class="hljs-attr">anyMethod</span>=<span class="hljs-string">&#123;this.anyMethod&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; componentDetails, anyMethod &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; render -&gt; anyMethod&quot;</span>, anyMethod);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; render -&gt; componentDetails&quot;</span>, componentDetails);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>&#123;componentDetails?.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>本示例中，我们主要的正确写法就是直接将变量传递给子组件，因为变量的引用是相同的，因此经过<strong>PureComponent</strong>的检查，引用没有改变，从而阻止了子组件的渲染！！</p>
<p><strong>说明： 严格来说，这个错误的示例是写法的问题，导致子组件的重新渲染，所以谈不上优化，因此我们要禁止像错误示例那样书写代码！</strong></p>
<h3 id="Hooks-示例-1"><a href="#Hooks-示例-1" class="headerlink" title="Hooks 示例"></a>Hooks 示例</h3><h4 id="❎-错误示例预览-2"><a href="#❎-错误示例预览-2" class="headerlink" title="❎ 错误示例预览"></a>❎ 错误示例预览</h4><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7bb39ef843e492ab780e9d29430e146~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="2.HooksBad.gif"></p>
<h4 id="❎-错误示例-3"><a href="#❎-错误示例-3" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son</span> = (<span class="hljs-params">&#123; componentDetails, anyMethod &#125;</span>) =&gt; &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; componentDetails&quot;</span>, componentDetails);<br>  &#125;, [componentDetails]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; anyMethod&quot;</span>, anyMethod);<br>  &#125;, [anyMethod]);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>&#123;componentDetails.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">componentDetails</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">name:</span> &quot;<span class="hljs-attr">子组件</span>&quot; &#125;&#125; <span class="hljs-attr">anyMethod</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;&#125;&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Son</span>, <span class="hljs-title class_">Parent</span> &#125;;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个错误示例当中，还是传递props的写法问题！！接下来看看如何改正！</p>
<h4 id="✅-正确示例-1-3"><a href="#✅-正确示例-1-3" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son</span> = (<span class="hljs-params">&#123; componentDetails, anyMethod &#125;</span>) =&gt; &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; componentDetails&quot;</span>, componentDetails);<br>  &#125;, [componentDetails]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; anyMethod&quot;</span>, anyMethod);<br>  &#125;, [anyMethod]);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>&#123;componentDetails.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-comment">// 这种写法 针对于 不变的值 可以这样传递</span><br><span class="hljs-keyword">const</span> componentDetails = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;子组件&quot;</span> &#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">anyMethod</span> = (<span class="hljs-params"></span>) =&gt; &#123;&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">componentDetails</span>=<span class="hljs-string">&#123;componentDetails&#125;</span> <span class="hljs-attr">anyMethod</span>=<span class="hljs-string">&#123;anyMethod&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个示例中，我们只是将不变的值 <strong>提到组件之外</strong> 以保证引用的唯一，不会因为组件的更新而改变。但是这种写法有一定的局限性。就是只适合于不变的值。但也有效的避免了组件的重复渲染。</p>
<h4 id="✅-正确示例-2-2"><a href="#✅-正确示例-2-2" class="headerlink" title="✅ 正确示例 2"></a>✅ 正确示例 2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; useState, useEffect, useMemo, useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son</span> = (<span class="hljs-params">&#123; componentDetails, anyMethod &#125;</span>) =&gt; &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; componentDetails&quot;</span>, componentDetails);<br>  &#125;, [componentDetails]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Son -&gt; anyMethod&quot;</span>, anyMethod);<br>  &#125;, [anyMethod]);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>&#123;componentDetails.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> old + <span class="hljs-number">1</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> anyMethod = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;, []);<br><br>  <span class="hljs-keyword">const</span> [componentDetails] = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> componentDetails = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;子组件&quot;</span> &#125;;<br>    <span class="hljs-keyword">return</span> [componentDetails];<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>父组件Count--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">componentDetails</span>=<span class="hljs-string">&#123;componentDetails&#125;</span> <span class="hljs-attr">anyMethod</span>=<span class="hljs-string">&#123;anyMethod&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个示例中，使用了 <strong>useCallback</strong> 于 <strong>useMemo</strong> 这个两个优化Hook，主要就是根据依赖是否改变来确定是否要更新值的变化，以保证值的引用不变。这中写法适合于大部分的写法，但是也不能过度使用。要不然代码会很混乱。</p>
<h3 id="Context的更新导致组件渲染"><a href="#Context的更新导致组件渲染" class="headerlink" title="Context的更新导致组件渲染"></a>Context的更新导致组件渲染</h3><h3 id="Class-示例-2"><a href="#Class-示例-2" class="headerlink" title="Class 示例"></a>Class 示例</h3><h4 id="❎-错误示例预览-3"><a href="#❎-错误示例预览-3" class="headerlink" title="❎ 错误示例预览"></a>❎ 错误示例预览</h4><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b15006e4a38d4327ab68b10e2bd1b270~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="3.ClassBad.gif"></p>
<h4 id="❎-错误示例-4"><a href="#❎-错误示例-4" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">undefined</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">handleIncrement</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleIncrement</span><br>    &#125;;<br>  &#125;<br>  handleIncrement = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br><br><br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Provider</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">            &#123;(conProps) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> <span class="hljs-attr">conProps</span>=<span class="hljs-string">&#123;conProps&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Provider</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 1 重新渲染了！！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 2 重新渲染了！！&quot;</span>);<br><br>    <span class="hljs-keyword">const</span> &#123;<br>      <span class="hljs-attr">conProps</span>: &#123; count, handleIncrement &#125;,<br>    &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件 2--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Parent</span> &#125;;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个例子当中，仔细体会，当点击子组件2中的按钮时，<strong>改变的是父组件中的state</strong> 所以造成的问题就是 父组件的渲染导致子组件也渲染了。那应该怎样避免子组件的重复渲染呢？</p>
<h4 id="✅-正确示例-1-4"><a href="#✅-正确示例-1-4" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">undefined</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">handleIncrement</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleIncrement</span><br>    &#125;;<br>  &#125;<br>  handleIncrement = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; children &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Provider</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">          &#123;children&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">            &#123;(conProps) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> <span class="hljs-attr">conProps</span>=<span class="hljs-string">&#123;conProps&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Provider</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 1 重新渲染了！！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 2 重新渲染了！！&quot;</span>);<br><br>    <span class="hljs-keyword">const</span> &#123;<br>      <span class="hljs-attr">conProps</span>: &#123; count, handleIncrement &#125;,<br>    &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件 2--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Parent</span>, <span class="hljs-title class_">Son1</span> &#125;;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Parent</span>&gt;</span></span><br><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个示例中，我们还是借用了<strong>children</strong> 的机制，直接渲染，那么在父组件当中就没有 <strong>Ract.createElement(Son)</strong> 这个api的执行，因此就不会造成重复的渲染！</p>
<h4 id="✅-正确示例-2-3"><a href="#✅-正确示例-2-3" class="headerlink" title="✅ 正确示例 2"></a>✅ 正确示例 2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; <span class="hljs-title class_">Component</span>, createContext, <span class="hljs-title class_">PureComponent</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">undefined</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">handleIncrement</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">handleIncrement</span><br>    &#125;;<br>  &#125;<br>  handleIncrement = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; count &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span>,<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Provider</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.state&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">            &#123;(conProps) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> <span class="hljs-attr">conProps</span>=<span class="hljs-string">&#123;conProps&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Consumer</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">contextValue.Provider</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 1 重新渲染了！！&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件 2 重新渲染了！！&quot;</span>);<br><br>    <span class="hljs-keyword">const</span> &#123;<br>      <span class="hljs-attr">conProps</span>: &#123; count, handleIncrement &#125;,<br>    &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件 2--&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中，主要是借用了 <strong>PureComponent</strong> 这个类帮我们自动执行优化，因此也是可以避免重复的渲染。</p>
<p><strong>说明：这里你也可以强行使用一下React.memo。</strong></p>
<h3 id="Hooks-示例-2"><a href="#Hooks-示例-2" class="headerlink" title="Hooks 示例"></a>Hooks 示例</h3><h4 id="❎-错误示例预览-4"><a href="#❎-错误示例预览-4" class="headerlink" title="❎ 错误示例预览"></a>❎ 错误示例预览</h4><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69380ea1d85e49a9b624e35b4abebc45~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/blog/img/loading.gif" lazyload alt="3.HooksBad.gif"></p>
<h4 id="❎-错误示例-5"><a href="#❎-错误示例-5" class="headerlink" title="❎ 错误示例"></a>❎ 错误示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createContext, useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useCustomReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../useCustomizeContext&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomizeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">undefined</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son1</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件1 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son2</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, handleIncrement &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CustomizeContext</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件2 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件2-&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useCustomReducer</span>(&#123; <span class="hljs-attr">initValue</span>: <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomizeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>错误示例<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">CustomizeContext.Provider</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Son1</span>, <span class="hljs-title class_">Parent</span>, <span class="hljs-title class_">Son2</span> &#125;;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中 使用了<strong>createContext，useContext，useReducer</strong> 这几个api 实现了一个小型的Redux。再点击子组件2中的按钮，改变了count的值，进而导致 value 改变，因此父组件渲染，导致子组件也跟着渲染。</p>
<h4 id="✅-正确示例-1-5"><a href="#✅-正确示例-1-5" class="headerlink" title="✅ 正确示例 1"></a>✅ 正确示例 1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">CustomizeProvider</span>,<br>  useCustomizeContext,<br>  useCustomReducer,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../useCustomizeContext&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son1</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件1 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son2</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, handleIncrement &#125; = <span class="hljs-title function_">useCustomizeContext</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件2 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件2-&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params">&#123; children &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useCustomReducer</span>(&#123; <span class="hljs-attr">initValue</span>: <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomizeProvider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> /&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">CustomizeProvider</span>&gt;</span></span><br>  );<br>&#125;;<br><span class="hljs-keyword">export</span> &#123; <span class="hljs-title class_">Son1</span> &#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br><br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span>&gt;</span></span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Parent</span>&gt;</span></span><br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中我们依然是使用 <strong>children</strong> 来解决的重复渲染问题。这个方式还是很有效的！！</p>
<p><strong>说明： 其实在项目中一定要使用合适的优化手段！</strong></p>
<h4 id="✅-正确示例-2-4"><a href="#✅-正确示例-2-4" class="headerlink" title="✅ 正确示例 2"></a>✅ 正确示例 2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; memo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">CustomizeProvider</span>,<br>  useCustomizeContext,<br>  useCustomReducer,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../useCustomizeContext&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son1</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件1 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son2</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, handleIncrement &#125; = <span class="hljs-title function_">useCustomizeContext</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件2 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件2-&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><span class="hljs-comment">// 使用 memo</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoSon1</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Son1</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useCustomReducer</span>(&#123; <span class="hljs-attr">initValue</span>: <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomizeProvider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">MemoSon1</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">CustomizeProvider</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在本示例中也使用了 <strong>memo</strong> 这个api， 还是一样的，对比props的引用是否改变，决定是否更新。</p>
<h4 id="✅-正确示例-3-2"><a href="#✅-正确示例-3-2" class="headerlink" title="✅ 正确示例 3"></a>✅ 正确示例 3</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useMemo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">CustomizeProvider</span>,<br>  useCustomizeContext,<br>  useCustomReducer,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../useCustomizeContext&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son1</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件1 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span>子组件1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Son2</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, handleIncrement &#125; = <span class="hljs-title function_">useCustomizeContext</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;子组件2 重新渲染了！！&quot;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;son&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子组件2-&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleIncrement&#125;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Parent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useCustomReducer</span>(&#123; <span class="hljs-attr">initValue</span>: <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomizeProvider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>正确示例3<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Son2</span> /&gt;</span></span><br><span class="language-xml">        &#123;useMemo(</span><br><span class="language-xml">          () =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Son1</span> /&gt;</span></span><br><span class="language-xml">          ),</span><br><span class="language-xml">          []</span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">CustomizeProvider</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Parent</span>;<br>复制代码<br></code></pre></td></tr></table></figure>

<p><a href="https://link.juejin.cn/?target=https://codesandbox.io/s/react-code-best-practices-lzf1o">✋🏻 点击查看在线 demo</a></p>
<p>在这个示例中我们依然借助<strong>useMemo</strong> 这个优化Hook， 来进行对组件的优化。</p>
<h3 id="🤙🤙🤙-总结"><a href="#🤙🤙🤙-总结" class="headerlink" title="🤙🤙🤙 总结"></a>🤙🤙🤙 总结</h3><p>在本片文章中介绍了三种情况下的优化手段，主要就是使用了：</p>
<ul>
<li>🤙useMemo</li>
<li>🤙memo</li>
<li>🤙children</li>
<li>🤙useCallback</li>
<li>🤙PureComponent</li>
<li>🤙提取状态组件</li>
<li>🤙提取不变的值</li>
</ul>
<p>这些优化的手段可以在不同的情况使用，所以你如果在使用过程中，一定要结合代码的情况，使用合适的优化手段。</p>
<h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/blog/categories/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1/" class="category-chain-item">前端八股</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/blog/tags/%E5%89%8D%E7%AB%AF/">#前端</a>
      
        <a href="/blog/tags/react/">#react</a>
      
        <a href="/blog/tags/%E8%AE%A1%E7%AE%97/">#计算</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>前端八股 ｜ react篇</div>
      <div>https://yoonalis.github.io/blog/2023/04/06/前端八股 ｜ React篇/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Azure</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月6日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2023/04/06/%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1%20%EF%BD%9C%20%E5%B7%A5%E5%85%B7%E7%AF%87/" title="前端八股 ｜ 工具篇">
                        <span class="hidden-mobile">前端八股 ｜ 工具篇</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/blog/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/love.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
